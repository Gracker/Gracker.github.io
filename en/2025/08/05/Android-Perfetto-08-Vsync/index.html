<!DOCTYPE html>
<html lang="en">
    <!-- title -->
            <!-- keywords -->

                  <head>
                    <meta charset="utf-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
                    <meta name="author" content="Gracker">
                    <meta name="renderer" content="webkit">
                    <meta name="copyright" content="Gracker">
                      <meta name="keywords" content="Android,Performance,AndroidPerformance,性能,优化,性能优化,Perf,Flutter,Linux,LinuxPerformance,AndroidFramework,Framework,Android Performance,Flutter,Kotlin,Memory,内存,流畅性,卡顿,响应速度,Jank,Smooth,Android Framework,ANR,Crash,Dalvik,ART,Jetpack,Compose,Optimization,Startup,Perfetto,Systrace,RenderThread,Java,Responsiveness,Smoothness">
                          <meta name="description" content="Technical blog about Android system performance optimization">
                          <meta name="description" content="This is the eighth article in the Perfetto series, providing an in-depth introduction to the Vsync mechanism in Android and its representation in Perfetto. The article will analyze how the Android sys">
<meta property="og:type" content="article">
<meta property="og:title" content="Android Perfetto Series 8: Understanding Vsync Mechanism and Performance Analysis">
<meta property="og:url" content="https://androidperformance.com/en/2025/08/05/Android-Perfetto-08-Vsync/index.html">
<meta property="og:site_name" content="Android Performance">
<meta property="og:description" content="This is the eighth article in the Perfetto series, providing an in-depth introduction to the Vsync mechanism in Android and its representation in Perfetto. The article will analyze how the Android sys">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://androidperformance.com/en/images/Android-Perfetto-08-Vsync/image-20250811221826847.png">
<meta property="og:image" content="https://androidperformance.com/en/images/Android-Perfetto-08-Vsync/image-20250811221902646.png">
<meta property="og:image" content="https://androidperformance.com/en/images/Android-Perfetto-08-Vsync/image-20250811222036489.png">
<meta property="og:image" content="https://androidperformance.com/en/images/Android-Perfetto-08-Vsync/image-20250811222159253.png">
<meta property="og:image" content="https://androidperformance.com/en/images/Android-Perfetto-08-Vsync/image-20250918220632473.png">
<meta property="og:image" content="https://androidperformance.com/en/images/Android-Perfetto-08-Vsync/image-20250918220709655.png">
<meta property="og:image" content="https://androidperformance.com/en/images/Android-Perfetto-08-Vsync/image-20250918220730872.png">
<meta property="og:image" content="https://androidperformance.com/en/images/Android-Perfetto-08-Vsync/image-20250918221821265.png">
<meta property="og:image" content="https://androidperformance.com/en/images/Android-Perfetto-08-Vsync/image-20250918221936675.png">
<meta property="og:image" content="https://androidperformance.com/en/images/Android-Perfetto-08-Vsync/image-20250918222045731.png">
<meta property="og:image" content="https://androidperformance.com/en/images/Android-Perfetto-08-Vsync/image-20250918222258536.png">
<meta property="og:image" content="https://androidperformance.com/en/images/Android-Perfetto-08-Vsync/image-20250918222626100.png">
<meta property="og:image" content="https://androidperformance.com/en/images/Android-Perfetto-08-Vsync/image-20250918222707300.png">
<meta property="og:image" content="https://androidperformance.com/en/images/Android-Perfetto-08-Vsync/image-20250918223035361.png">
<meta property="og:image" content="https://androidperformance.com/en/images/Android-Perfetto-08-Vsync/image-20250918223148748.png">
<meta property="og:image" content="https://androidperformance.com/en/images/Android-Perfetto-08-Vsync/image-20250918222707300.png">
<meta property="og:image" content="https://androidperformance.com/en/images/Android-Perfetto-08-Vsync/image-20250918223220718.png">
<meta property="og:image" content="https://androidperformance.com/en/images/Android-Perfetto-08-Vsync/image-20250918223340940.png">
<meta property="og:image" content="https://androidperformance.com/en/images/Android-Perfetto-08-Vsync/image-20250918224205093.png">
<meta property="og:image" content="https://androidperformance.com/en/images/Android-Perfetto-08-Vsync/image-20250918223441117.png">
<meta property="og:image" content="https://androidperformance.com/en/images/Android-Perfetto-08-Vsync/image-20250918223517315.png">
<meta property="og:image" content="https://androidperformance.com/en/images/Android-Perfetto-08-Vsync/image-20250918223532482.png">
<meta property="og:image" content="https://androidperformance.com/en/images/WechatIMG581.png">
<meta property="article:published_time" content="2025-08-05T02:15:30.000Z">
<meta property="article:modified_time" content="2026-01-11T12:56:53.316Z">
<meta property="article:author" content="Gracker">
<meta property="article:tag" content="Android">
<meta property="article:tag" content="Perfetto">
<meta property="article:tag" content="Systrace">
<meta property="article:tag" content="Performance">
<meta property="article:tag" content="RenderThread">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://androidperformance.com/en/images/Android-Perfetto-08-Vsync/image-20250811221826847.png">
                            <meta http-equiv="Cache-control" content="no-cache">
                            <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
                            <link rel="icon" href="/en/assets/favicon.ico">
                                <title>
                                  Android Perfetto Series 8: Understanding Vsync Mechanism and Performance Analysis · Android Performance
                                </title>
                                <link rel="canonical" href="https://androidperformance.com/en/2025/08/05/Android-Perfetto-08-Vsync/">
                                <!-- /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
/* This file is meant as a standalone workflow for
- testing support for link[rel=preload]
- enabling async CSS loading in browsers that do not support rel=preload
- applying rel preload css once loaded, whether supported or not.
*/ -->
<script>
    (function (w) {
        'use strict'
        // rel=preload support test
        if (!w.loadCSS) {
            w.loadCSS = function () {}
        }
        // define on the loadCSS obj
        var rp = (loadCSS.relpreload = {})
        // rel=preload feature support test
        // runs once and returns a function for compat purposes
        rp.support = (function () {
            var ret
            try {
                ret = w.document.createElement('link').relList.supports('preload')
            } catch (e) {
                ret = false
            }
            return function () {
                return ret
            }
        })()

        // if preload isn't supported, get an asynchronous load by using a non-matching media attribute
        // then change that media back to its intended value on load
        rp.bindMediaToggle = function (link) {
            // remember existing media attr for ultimate state, or default to 'all'
            var finalMedia = link.media || 'all'

            function enableStylesheet() {
                link.media = finalMedia
            }

            // bind load handlers to enable media
            if (link.addEventListener) {
                link.addEventListener('load', enableStylesheet)
            } else if (link.attachEvent) {
                link.attachEvent('onload', enableStylesheet)
            }

            // Set rel and non-applicable media type to start an async request
            // note: timeout allows this to happen async to let rendering continue in IE
            setTimeout(function () {
                link.rel = 'stylesheet'
                link.media = 'only x'
            })
            // also enable media after 3 seconds,
            // which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
            setTimeout(enableStylesheet, 3000)
        }

        // loop through link elements in DOM
        rp.poly = function () {
            // double check this to prevent external calls from running
            if (rp.support()) {
                return
            }
            var links = w.document.getElementsByTagName('link')
            for (var i = 0; i < links.length; i++) {
                var link = links[i]
                // qualify links to those with rel=preload and as=style attrs
                if (
                    link.rel === 'preload' &&
                    link.getAttribute('as') === 'style' &&
                    !link.getAttribute('data-loadcss')
                ) {
                    // prevent rerunning on link
                    link.setAttribute('data-loadcss', true)
                    // bind listeners to toggle media back
                    rp.bindMediaToggle(link)
                }
            }
        }

        // if unsupported, run the polyfill
        if (!rp.support()) {
            // run once at least
            rp.poly()

            // rerun poly on an interval until onload
            var run = w.setInterval(rp.poly, 500)
            if (w.addEventListener) {
                w.addEventListener('load', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            } else if (w.attachEvent) {
                w.attachEvent('onload', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            }
        }

        // commonjs
        if (typeof exports !== 'undefined') {
            exports.loadCSS = loadCSS
        } else {
            w.loadCSS = loadCSS
        }
    })(typeof global !== 'undefined' ? global : this)
</script>

                                  <style type="text/css">
    @font-face {
        font-family: 'Oswald-Regular';
        src: url("/en/font/Oswald-Regular.woff2") format('woff2'),
             url("/en/font/Oswald-Regular.ttf") format('truetype');
        font-display: swap;
    }

    body {
        margin: 0;
    }

    /* Removed initial hide to show content immediately */

    .site-intro {
        position: relative;
        z-index: 3;
        width: 100%;
        /* height: 50vh; */
        overflow: hidden;
    }

    .site-intro-placeholder {
        position: absolute;
        z-index: -2;
        top: 0;
        left: 0;
        width: calc(100% + 300px);
        height: 100%;
        background: repeating-linear-gradient(
            -45deg,
            #444 0,
            #444 80px,
            #333 80px,
            #333 160px
        );
        background-position: center center;
        transform: translate3d(-226px, 0, 0);
        animation: gradient-move 2.5s ease-out 0s infinite;
    }

    @keyframes gradient-move {
        0% {
            transform: translate3d(-226px, 0, 0);
        }
        100% {
            transform: translate3d(0, 0, 0);
        }
    }
</style>

                                    <link id="stylesheet-base" rel="stylesheet" href="/en/%20css/style.css">
                                    <link id="stylesheet-mobile" rel="stylesheet" href="/en/%20css/mobile.css" media="screen and (max-width: 960px)">
                                    <link id="stylesheet-theme-dark" rel="stylesheet" href="/en/%20css/dark.css">
                                    <!-- Font Awesome CSS (with CDN fallback) -->
                                    <link id="stylesheet-fontawesome" rel="stylesheet"
                                      href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.4/css/all.min.css">
                                    <script>
                                      // Fallback for Font Awesome if CDN fails
                                      var faLink = document.getElementById('stylesheet-fontawesome');
                                      faLink.onerror = function () {
                                        var newLink = document.createElement('link');
                                        newLink.rel = 'stylesheet';
                                        newLink.href = 'https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css';
                                        document.head.appendChild(newLink);
                                      };
                                    </script>
                                    <link rel="preconnect" href="https://cdn.bootcdn.net" crossorigin>
                                    <link rel="dns-prefetch" href="//cdn.bootcdn.net">
                                    <link rel="preconnect" href="https://cdn.staticfile.org" crossorigin>
                                    <link rel="dns-prefetch" href="//cdn.staticfile.org">
                                    <link rel="preload"
                                      href="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js" as="script">
                                    <link rel="preload" href="/en/scripts/main.js" as="script">
                                    <!-- use compressed font format to reduce transfer size -->
                                    <link rel="preload" href="/en/font/Source%5C%20Sans%5C%20Pro.woff2"
                                      as="font" type="font/woff2" crossorigin>
                                    <link rel="preload" href="/en/font/Source%5C%20Sans%5C%20Pro.woff" as="font"
                                      type="font/woff" crossorigin>
                                    <link rel="preload" href="https://at.alicdn.com/t/font_327081_1dta1rlogw17zaor.woff"
                                      as="font" crossorigin>
                                    <!-- algolia -->
                                        <!-- 百度统计（延迟加载，失败静默）  -->
                                            <!-- CNZZ（延迟加载，失败静默）  -->
                                                <!-- Google tag (gtag.js) 延迟加载，失败静默 -->
                                                  <script>
                                                    (function () {
                                                      function loadGtag() {
                                                        try {
                                                          window.dataLayer = window.dataLayer || []
                                                          function gtag() { dataLayer.push(arguments) }
                                                          window.gtag = gtag
                                                          gtag('js', new Date())
                                                          var s = document.createElement('script')
                                                          s.async = true
                                                          s.src = 'https://www.googletagmanager.com/gtag/js?id=UA-50993302-2'
                                                          s.onerror = function () { }
                                                          s.onload = function () { gtag('config', 'UA-50993302-2') }
                                                          document.head.appendChild(s)
                                                        } catch (e) { }
                                                      }
                                                      if (window.requestIdleCallback) {
                                                        requestIdleCallback(loadGtag, { timeout: 5000 })
                                                      } else {
                                                        window.addEventListener('load', function () { setTimeout(loadGtag, 3000) })
                                                      }
                                                    })();
                                                  </script>
                                                    <!-- Hreflang Tags -->
                                                    
                                                      <link rel="alternate" hreflang="zh-CN" href="https://androidperformance.com/2025/08/05/Android-Perfetto-08-Vsync/" />
                                                      <link rel="alternate" hreflang="en" href="https://androidperformance.com/en/2025/08/05/Android-Perfetto-08-Vsync/" />
                                                      <link rel="alternate" hreflang="x-default" href="https://androidperformance.com/en/2025/08/05/Android-Perfetto-08-Vsync/" />
                  <meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/en/atom.xml" title="Android Performance" type="application/atom+xml">
</head>
        <body class="post-body">
        <!-- header -->
        <header class="header header-mobile">
    <!-- top read progress line -->
    <div class="header-element">
        <div class="read-progress"></div>
    </div>
    <!-- sidebar menu button -->
    <div class="header-element">
        <div
            class="header-sidebar-menu">
                    <div style="padding-left: 1px;">&#xe775;</div>
        </div>
    </div>
    <!-- header actions -->
    <div class="header-actions">
        <!-- theme mode switch button -->
        <span class="header-theme-btn header-element">
            <i class="fas fa-adjust"></i>
        </span>
        <!-- language transition button -->
        <span class="header-lang-btn header-element">
            <a href="javascript:void(0)" onclick="toggleLanguage()" style="color: inherit; text-decoration: none;">
                <i class="fas fa-globe"></i>
            </a>
            <script>
                function toggleLanguage() {
                    var path = window.location.pathname;
                    console.log('Current path:', path);
                    // Check if path starts with /en/ or is exactly /en
                    var isEn = /^\/en(\/|$)/.test(path);

                    if (isEn) {
                        // Switch to CN: remove /en prefix
                        // If path is /en or /en/, it becomes /
                        // If path is /en/foo, it becomes /foo
                        var newPath = path.replace(/^\/en(\/|$)/, '/');
                        // Ensure we don't end up with empty string if something weird happens, though / covers it
                        if (newPath === '') newPath = '/';
                        // Clean up double slashes if any (except root /)
                        if (newPath !== '/' && newPath.endsWith('/')) newPath = newPath.slice(0, -1) + '/';
                        console.log('Switching to CN:', newPath);
                        window.location.href = newPath;
                    } else {
                        // Switch to EN: add /en prefix
                        // Handle root / specially to avoid /en//
                        var suffix = path;
                        if (suffix === '/') suffix = '';
                        console.log('Switching to EN:', '/en' + suffix);
                        window.location.href = '/en' + suffix;
                    }
                }
            </script>
        </span>
        <!-- back to home page text -->
        <span class="home-link header-element">
            <a href="/en/">Android Performance</a>
        </span>
    </div>
    <!-- toggle banner -->
                <div class="banner">
                        <div class="blog-title header-element">
                            <a href="/en/">
                                Android Performance
                            </a>
                        </div>
                        <div class="post-title header-element">
                            <a href="#" class="post-name">Android Perfetto Series 8: Understanding Vsync Mechanism and Performance Analysis</a>
                        </div>
                </div>
</header>
        <!-- fixed footer -->
        <footer class="footer-fixed">
    <!-- donate button -->
    <div class="donate-popup donate-popup--hidden">
    <div class="donate-popup__title">Buy Me A Coffee</div>
    <div class="donate-popup__content">
        <div class="donate-popup__content-description">If you find this article helpful, consider buying me a coffee.</div>
        <img
            class="donate-popup__content-qrCode"
            title="Wechat"
            alt="Wechat"
            src="/en/assets/donate-wechat.png"
        ></img>
        <img
            class="donate-popup__content-qrCode"
            title="Alipay"
            alt="Alipay"
            src="/en/assets/donate-alipay.png"
        ></img>
    </div>
</div>

    <div
        title="Donate to the author"
        class="footer-fixed-btn footer-fixed-btn--hidden donate-btn"
    >
        <i class="fas fa-donate"></i>
    </div>

    <!-- back to top button -->
    <div class="footer-fixed-btn footer-fixed-btn--hidden back-top">
        <div>&#xe639;</div>
    </div>
</footer>

        <!-- wrapper -->
        <div class="wrapper">
            <div class="site-intro" style="    height:50vh;
">
    <!-- 主页  -->
    <!-- 404页  -->
    <div class="site-intro-placeholder"></div>
    <picture>
            <source type="image/webp" srcset="/en/intro/post-bg.webp">
        <img class="site-intro-img"
             src="/en/intro/post-bg.jpg"
             alt=""
loading="lazy"             decoding="async"
             fetchpriority="auto"
             sizes="100vw">
    </picture>
    <div class="site-intro-meta">
        <!-- 标题  -->
        <h1 class="intro-title">
            <!-- 主页  -->
                Android Perfetto Series 8: Understanding Vsync Mechanism and Performance Anal...
            <!-- 404 -->
        </h1>
        <!-- 副标题 -->
        <p class="intro-subtitle">
            <!-- 主页副标题  -->
            <!-- 404 -->
        </p>
        <!-- 文章页 meta -->
            <div class="post-intros">
                <!-- 文章页标签  -->
                    <div class="post-intro-tags" >
        <span class="post-category" data-categories="Java">
            <i class="fas fa-folder post-category-icon"></i>
            <span class="post-category-text">
                Java
            </span>
        </span>
        <a class="post-tag" href="javascript:void(0);" data-tags="Android">Android</a>
        <a class="post-tag" href="javascript:void(0);" data-tags="Perfetto">Perfetto</a>
        <a class="post-tag" href="javascript:void(0);" data-tags="Systrace">Systrace</a>
        <a class="post-tag" href="javascript:void(0);" data-tags="Performance">Performance</a>
        <a class="post-tag" href="javascript:void(0);" data-tags="RenderThread">RenderThread</a>
</div>

                <!-- 文章字数统计 -->
                    <div class="post-intro-read">
                        <span>Word count: <span class="post-count word-count">4.6k</span>Reading time: <span class="post-count reading-time">28 min</span></span>
                    </div>
                <div class="post-intro-meta">
                    <!-- 撰写日期 -->
                    <span class="iconfont-archer post-intro-calander">&#xe676;</span>
                    <span class="post-intro-time">2025/08/05</span>
                    <!-- 文章分享 -->
                    <span class="share-wrapper">
                        <span class="iconfont-archer share-icon">&#xe71d;</span>
                        <span class="share-text">Share</span>
                        <ul class="share-list">
                            <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
                                <div class="share-qrcode"></div>
                            </li>
                            <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
                            <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
                            <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
                            <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
                        </ul>
                    </span>
                </div>
            </div>
    </div>
</div>

            
            <script>
  // get user agent
  function getBrowserVersions() {
    var u = window.navigator.userAgent
    return {
      userAgent: u,
      trident: u.indexOf('Trident') > -1, //IE内核
      presto: u.indexOf('Presto') > -1, //opera内核
      webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
      gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
      mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
      ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
      android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
      iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者安卓QQ浏览器
      iPad: u.indexOf('iPad') > -1, //是否为iPad
      webApp: u.indexOf('Safari') == -1, //是否为web应用程序，没有头部与底部
      weixin: u.indexOf('MicroMessenger') == -1, //是否为微信浏览器
      uc: u.indexOf('UCBrowser') > -1, //是否为android下的UC浏览器
    }
  }
  var browser = {
    versions: getBrowserVersions(),
  }
  console.log('userAgent: ' + browser.versions.userAgent)

  // callback
  function fontLoaded() {
    console.log('font loaded')
    if (document.getElementsByClassName('site-intro-meta')) {
      document
        .getElementsByClassName('intro-title')[0]
        .classList.add('intro-fade-in')
      document
        .getElementsByClassName('intro-subtitle')[0]
        .classList.add('intro-fade-in')
      var postIntros = document.getElementsByClassName('post-intros')[0]
      if (postIntros) {
        postIntros.classList.add('post-fade-in')
      }
    }
  }

  // UC不支持跨域，所以直接显示
  function asyncCb() {
    if (browser.versions.uc) {
      console.log('UCBrowser')
      fontLoaded()
    } else {
      WebFont.load({
        custom: {
          families: ['Oswald-Regular'],
        },
        loading: function () {
          // 所有字体开始加载
          // console.log('font loading');
        },
        active: function () {
          // 所有字体已渲染
          fontLoaded()
        },
        inactive: function () {
          // 字体预加载失败，无效字体或浏览器不支持加载
          console.log('inactive: timeout')
          fontLoaded()
        },
        timeout: 5000, // Set the timeout to two seconds
      })
    }
  }

  function asyncErr() {
    console.warn('script load from CDN failed, will load local script')
  }

  // load webfont-loader async, and add callback function
  function async(u, cb, err) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0]
    o.src = u
    if (cb) {
      o.addEventListener(
        'load',
        function (e) {
          cb(null, e)
        },
        false
      )
    }
    if (err) {
      o.addEventListener(
        'error',
        function (e) {
          err(null, e)
        },
        false
      )
    }
    s.parentNode.insertBefore(o, s)
  }

  var asyncLoadWithFallBack = function (arr, success, reject) {
    var currReject = function () {
      reject()
      arr.shift()
      if (arr.length) async(arr[0], success, currReject)
    }

    async(arr[0], success, currReject)
  }

  asyncLoadWithFallBack(
    [
      'https://cdn.bootcdn.net/ajax/libs/webfont/1.6.28/webfontloader.min.js',
      'https://cdn.staticfile.org/webfont/1.6.28/webfontloader.min.js',
      'https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js',
      "/en/lib/webfontloader.min.js",
    ],
    asyncCb,
    asyncErr
  )
</script>

            <img class="loading" src="/en/assets/loading.svg" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" alt="loading">
            <div class="container container-unloaded">
                <main class="main post-page">
    <article class="article-entry">
        <p>This is the eighth article in the Perfetto series, providing an in-depth introduction to the Vsync mechanism in Android and its representation in Perfetto. The article will analyze how the Android system performs frame rendering and composition based on Vsync signals from Perfetto’s perspective, covering core concepts such as Vsync, Vsync-app, Vsync-sf, and VsyncWorkDuration.</p>
<p>With the popularization of high refresh rate screens, understanding the Vsync mechanism has become increasingly important. This article uses 120Hz refresh rate as the main narrative thread to help developers understand the working principles of Vsync in modern Android devices, and how to observe and analyze Vsync-related performance issues in Perfetto.</p>
<blockquote>
<p><strong>Note: This article is based on Android 16’s latest architecture and implementation</strong></p>
</blockquote>
<span id="more"></span>

<h2 id="Table-of-Contents"><a href="#Table-of-Contents" class="headerlink" title="Table of Contents"></a>Table of Contents</h2><ul>
<li><a href="#series">Series Catalog</a></li>
<li><a href="#what-is-vsync">What is Vsync</a></li>
<li><a href="#principle">Basic Working Principles of Vsync in Android</a></li>
<li><a href="#perfetto-observe">Observing Vsync in Perfetto</a></li>
<li><a href="#app-frames">How Android App Frames Work Based on Vsync</a></li>
<li><a href="#refs">References</a></li>
<li><a href="#about">About Me &amp;&amp; Blog</a></li>
</ul>
<p><a id="series"></a></p>
<h1 id="Series-Catalog"><a href="#Series-Catalog" class="headerlink" title="Series Catalog"></a>Series Catalog</h1><ol>
<li><a target="_blank" rel="noopener" href="https://www.androidperformance.com/en/2024/03/27/Android-Perfetto-101/#/Perfetto-Series-Catalog">Android Perfetto Series Catalog</a></li>
<li><a target="_blank" rel="noopener" href="https://www.androidperformance.com/en/2024/05/21/Android-Perfetto-01-What-is-perfetto/">Android Perfetto Series 1: Introduction to Perfetto</a></li>
<li><a target="_blank" rel="noopener" href="https://www.androidperformance.com/en/2024/05/21/Android-Perfetto-02-how-to-get-perfetto/">Android Perfetto Series 2: Capturing Perfetto Traces</a></li>
<li><a target="_blank" rel="noopener" href="https://www.androidperformance.com/en/2024/05/21/Android-Perfetto-03-how-to-analysis-perfetto/">Android Perfetto Series 3: Familiarizing with Perfetto View</a></li>
<li><a target="_blank" rel="noopener" href="https://www.androidperformance.com/en/2025/02/08/Android-Perfetto-04-Open-Big-Trace-With-Command-Line/">Android Perfetto Series 4: Opening Large Traces via Command Line</a></li>
<li><a target="_blank" rel="noopener" href="https://www.androidperformance.com/en/2025/03/26/Android-Perfetto-05-Chorergrapher/">Android Perfetto Series 5: Android App Rendering Flow Based on Choreographer</a></li>
<li><a target="_blank" rel="noopener" href="https://www.androidperformance.com/en/2025/04/26/Android-Perfetto-06-Why-120Hz/">Android Perfetto Series 6: Why 120Hz? Advantages and Challenges of High Refresh Rates</a></li>
<li><a href="https://androidperformance.com/en/2025/08/02/Android-Perfetto-07-MainThread-And-RenderThread/">Android Perfetto Series 7: MainThread and RenderThread Deep Dive</a></li>
<li><a href="https://androidperformance.com/en/2025/08/05/Android-Perfetto-08-Vsync/">Android Perfetto Series 8: Understanding Vsync Mechanism and Performance Analysis</a></li>
<li><a target="_blank" rel="noopener" href="https://www.androidperformance.com/en/2025/11/12/Android-Perfetto-09-CPU/">Android Perfetto Series 9: CPU Information Interpretation</a></li>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1oi82efE4D/?vd_source=0c6d2191e785de0a36dc21a9da7e664e">Video (Bilibili) - Android Perfetto Basics and Case Sharing</a></li>
</ol>
<p>If you haven’t read the Systrace series yet, here are the links:</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://www.androidperformance.com/2019/05/26/Android_Systrace_0/#/Series-Catalog">Systrace Series Catalog</a>: A systematic introduction to Systrace, Perfetto’s predecessor, and learning about Android performance optimization and Android system operation basics through Systrace.</li>
<li><a target="_blank" rel="noopener" href="https://www.androidperformance.com/">Personal Blog</a>: My personal blog, mainly Android-related content, with some life and work-related content as well.</li>
</ol>
<p>Welcome to join the WeChat group or community on the <a target="_blank" rel="noopener" href="https://www.androidperformance.com/about/">About Me</a> page to discuss your questions, what you’d most like to see about Perfetto, and all Android development-related topics with fellow group members.</p>
<p><a id="what-is-vsync"></a></p>
<h2 id="What-is-Vsync"><a href="#What-is-Vsync" class="headerlink" title="What is Vsync"></a>What is Vsync</h2><p>Vsync (Vertical Synchronization) is the core mechanism of the Android graphics system. Its existence is to solve a fundamental problem: how to keep the software rendering rhythm synchronized with the hardware display rhythm.</p>
<p>Before the Vsync mechanism existed, the common problem was Screen Tearing. When the display reads the framebuffer while the GPU writes the next frame, the same refresh will show inconsistent top and bottom parts of the image.</p>
<h3 id="What-Problems-Does-Vsync-Solve"><a href="#What-Problems-Does-Vsync-Solve" class="headerlink" title="What Problems Does Vsync Solve?"></a>What Problems Does Vsync Solve?</h3><p>The core idea of the Vsync mechanism is very simple: <strong>make all rendering work proceed according to the display’s refresh beat</strong>. Specifically:</p>
<ol>
<li><strong>Synchronization Signal</strong>: The display emits a Vsync signal every time it starts a new refresh cycle.</li>
<li><strong>Frame Beat and Production</strong>: On the application side, when Vsync arrives, Choreographer drives the production of a frame (Input&#x2F;Animation&#x2F;Traversal); after the CPU submits rendering commands, the GPU executes asynchronously in a pipeline. On the SurfaceFlinger side, when Vsync arrives, Buffer composition operations are performed.</li>
<li><strong>Buffering Mechanism</strong>: Using double buffering or triple buffering technology ensures the display always reads complete frame data.</li>
</ol>
<p>This way, frame production and display are aligned with Vsync as the beat. Taking 120Hz as an example, there’s a display opportunity every 8.333ms; the application needs to submit a compositable Buffer to SurfaceFlinger before this window. The key constraint is the timing of <code>queueBuffer</code>&#x2F;<code>acquire_fence</code>&#x2F;<code>present_fence</code>; if it doesn’t catch up with this cycle, it will be delayed to the next cycle for display.</p>
<p><a id="principle"></a></p>
<h2 id="Basic-Working-Principles-of-Vsync-in-Android"><a href="#Basic-Working-Principles-of-Vsync-in-Android" class="headerlink" title="Basic Working Principles of Vsync in Android"></a>Basic Working Principles of Vsync in Android</h2><p>Android system’s Vsync implementation is much more complex than the basic concept, needing to consider multiple different rendering components and their coordinated work.</p>
<h3 id="Layered-Architecture-of-Vsync-Signals"><a href="#Layered-Architecture-of-Vsync-Signals" class="headerlink" title="Layered Architecture of Vsync Signals"></a>Layered Architecture of Vsync Signals</h3><p>In the Android system, there isn’t just one simple Vsync signal. In fact, the system maintains multiple Vsync signals for different purposes:</p>
<p><strong>Hardware Vsync (HW Vsync)</strong>:<br>This is the lowest-level Vsync signal, generated by the display hardware (HWC, Hardware Composer). Its frequency strictly corresponds to the display’s refresh rate, for example, a 60Hz display generates HW Vsync every 16.67ms, and a 120Hz display generates one every 8.333ms. (Hardware Vsync callbacks are managed by HWC&#x2F;SurfaceFlinger, see <code>frameworks/native/services/surfaceflinger</code> related implementation)</p>
<p>However, HW Vsync is not always on. Since frequent hardware interrupts consume considerable power, the Android system adopts an intelligent strategy: only enabling HW Vsync when precise synchronization is needed, and using software prediction to generate Vsync signals most of the time.</p>
<p><strong>Vsync-app (Application Vsync)</strong>:<br>This is a Vsync signal specifically used to drive application layer rendering. When an application needs to perform UI updates (such as user touch, animation running, interface scrolling, etc.), the application will request to receive Vsync-app signals from the system.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// frameworks/base/core/java/android/view/Choreographer.java</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">scheduleFrameLocked</span><span class="params">(<span class="type">long</span> now)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!mFrameScheduled) &#123;</span><br><span class="line">        mFrameScheduled = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (USE_VSYNC) &#123;</span><br><span class="line">            <span class="comment">// Request next Vsync signal from system</span></span><br><span class="line">            mDisplayEventReceiver.scheduleVsync();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Vsync-app is requested on-demand. If the application interface is static with no animations or user interaction, the application won’t request Vsync-app signals, and the system won’t generate Vsync events for this application.</p>
<p><strong>Vsync-sf (SurfaceFlinger Vsync)</strong>:<br>This is a Vsync signal specifically used to drive SurfaceFlinger for layer composition. SurfaceFlinger is the service in the Android system responsible for compositing all application layers into the final image.</p>
<p><strong>Vsync-appSf (Application-SurfaceFlinger Vsync)</strong>:<br>A new signal type introduced in Android 13. To eliminate the timing ambiguity brought by the old design where the sf EventThread both woke up SurfaceFlinger and served some Choreographer clients, the system separated the two responsibilities: <code>vsync-sf</code> focuses on waking up SurfaceFlinger, while <code>vsync-appSf</code> faces clients that need to synchronize with SurfaceFlinger.</p>
<p><a id="perfetto-observe"></a></p>
<h2 id="Observing-Vsync-in-Perfetto"><a href="#Observing-Vsync-in-Perfetto" class="headerlink" title="Observing Vsync in Perfetto"></a>Observing Vsync in Perfetto</h2><p>Perfetto traces contain multiple Vsync-related Tracks. Understanding the meaning of these Tracks helps analyze performance issues.</p>
<p><strong>In the SurfaceFlinger Process</strong>:</p>
<ol>
<li><p><strong>vsync-app</strong><br>Displays application Vsync signal status, with values changing between 0 and 1. Each value change represents a Vsync signal.<br><img src="/en/images/Android-Perfetto-08-Vsync/image-20250811221826847.png" alt="image-20250811221826847"></p>
</li>
<li><p><strong>vsync-sf</strong><br>Displays SurfaceFlinger Vsync signal status. When there’s no Vsync Offset, it changes synchronously with <code>vsync-app</code>.<br><img src="/en/images/Android-Perfetto-08-Vsync/image-20250811221902646.png" alt="image-20250811221902646"></p>
</li>
<li><p><strong>vsync-appSf</strong><br>Added in Android 13+, serves special Choreographer clients that need to synchronize with SurfaceFlinger.<br><img src="/en/images/Android-Perfetto-08-Vsync/image-20250811222036489.png" alt="image-20250811222036489"></p>
</li>
<li><p><strong>HW_VSYNC</strong><br>Displays hardware Vsync enabled status. Value of 1 means enabled, value of 0 means disabled. To save power, hardware Vsync is only enabled when precise synchronization is needed.<br><img src="/en/images/Android-Perfetto-08-Vsync/image-20250811222159253.png" alt="image-20250811222159253"></p>
</li>
</ol>
<p><strong>In the Application Process</strong>:</p>
<p><code>FrameDisplayEventReceiver.onVsync</code> Slice Track:<br>Displays the time point when the application receives Vsync signals. Since signals are passed through Binder, the time may be slightly later than <code>vsync-app</code> in SurfaceFlinger.</p>
<p><img src="/en/images/Android-Perfetto-08-Vsync/image-20250918220632473.png" alt="image-20250918220632473"></p>
<p><code>UI Thread</code> Slice Track:<br>Contains <code>Choreographer#doFrame</code> and related Input, Animation, Traversal, etc. Slices. Each <code>doFrame</code> corresponds to one frame’s processing work.</p>
<p><img src="/en/images/Android-Perfetto-08-Vsync/image-20250918220709655.png" alt="image-20250918220709655"></p>
<p><code>RenderThread</code> Slice Track:<br>Contains <code>DrawFrame</code>, <code>syncAndDrawFrame</code>, <code>queueBuffer</code>, etc. Slices, corresponding to render thread work.</p>
<p><img src="/en/images/Android-Perfetto-08-Vsync/image-20250918220730872.png" alt="image-20250918220730872"></p>
<p><a id="app-frames"></a></p>
<h2 id="How-Android-App-Frames-Work-Based-on-Vsync"><a href="#How-Android-App-Frames-Work-Based-on-Vsync" class="headerlink" title="How Android App Frames Work Based on Vsync"></a>How Android App Frames Work Based on Vsync</h2><p>Each frame of an Android application completes the entire process from rendering to display based on the Vsync mechanism, involving multiple key steps.</p>
<p><img src="/en/images/Android-Perfetto-08-Vsync/image-20250918221821265.png" alt="image-20250918221821265"></p>
<h3 id="Process-Overview-In-Order"><a href="#Process-Overview-In-Order" class="headerlink" title="Process Overview (In Order)"></a>Process Overview (In Order)</h3><ol>
<li>Trigger Redraw&#x2F;Input: <code>View.invalidate()</code>, animation, data change, or input event triggers → <code>ViewRootImpl.scheduleTraversals()</code> → <code>Choreographer.postCallback(TRAVERSAL)</code></li>
<li>Request Vsync: <code>Choreographer</code> requests next Vsync (app phase) through <code>DisplayEventReceiver.scheduleVsync()</code></li>
<li>Receive Vsync: After <code>DisplayEventReceiver.onVsync()</code> receives Vsync, it posts an asynchronous message to the main thread message queue</li>
<li>Main Thread Frame Processing: <code>Choreographer.doFrame()</code> executes five types of callbacks in order: <code>INPUT → ANIMATION → INSETS_ANIMATION → TRAVERSAL → COMMIT</code></li>
<li>Rendering Submission: <code>RenderThread</code> executes <code>syncAndDrawFrame/DrawFrame</code>, CPU records GPU commands, <code>queueBuffer</code> submits to BufferQueue</li>
<li>Composition Display: <code>SurfaceFlinger</code> composites (GPU&#x2F;or HWC) when <code>vsync-sf</code> arrives, generates <code>present_fence</code>, outputs to display</li>
<li>Frame Completion Measurement: Determines whether displayed on schedule through <code>FrameTimeline</code> (PresentType&#x2F;JankType) and <code>acquire/present_fence</code></li>
</ol>
<p>Below we’ll expand on each step’s key implementation and Perfetto observation points.</p>
<h3 id="When-Does-App-Request-Vsync-Signals"><a href="#When-Does-App-Request-Vsync-Signals" class="headerlink" title="When Does App Request Vsync Signals"></a>When Does App Request Vsync Signals</h3><p>Applications don’t request Vsync signals all the time. Vsync signals are requested on-demand, only in the following situations will applications request the next Vsync from the system:</p>
<p><strong>Scenarios Triggering Vsync Request</strong>:</p>
<ol>
<li><strong>UI Update Needs</strong>: When View calls <code>invalidate()</code></li>
<li><strong>Animation Execution</strong>: When ValueAnimator, ObjectAnimator, and other animations start</li>
<li><strong>User Interaction</strong>: Touch events, key events, etc. requiring UI response</li>
<li><strong>Data Changes</strong>: RecyclerView data updates, TextView text changes, etc.</li>
</ol>
<h3 id="Complete-Process-of-App-Requesting-Vsync"><a href="#Complete-Process-of-App-Requesting-Vsync" class="headerlink" title="Complete Process of App Requesting Vsync"></a>Complete Process of App Requesting Vsync</h3><p>When an application needs to update UI, it requests Vsync signals through the following process:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. UI component requests redraw</span></span><br><span class="line"><span class="comment">// frameworks/base/core/java/android/view/View.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invalidate</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Mark as needing redraw, but don&#x27;t execute immediately</span></span><br><span class="line">    mPrivateFlags |= PFLAG_DIRTY;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (mParent != <span class="literal">null</span> &amp;&amp; mAttachInfo != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// Request redraw from parent container</span></span><br><span class="line">        mParent.invalidateChild(<span class="built_in">this</span>, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. ViewRootImpl schedules traversal</span></span><br><span class="line"><span class="comment">// frameworks/base/core/java/android/view/ViewRootImpl.java</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">scheduleTraversals</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!mTraversalScheduled) &#123;</span><br><span class="line">        mTraversalScheduled = <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">// Key: Register callback with Choreographer, wait for next Vsync</span></span><br><span class="line">        mChoreographer.postCallback(</span><br><span class="line">            Choreographer.CALLBACK_TRAVERSAL, mTraversalRunnable, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. Choreographer requests Vsync</span></span><br><span class="line"><span class="comment">// frameworks/base/core/java/android/view/Choreographer.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postCallback</span><span class="params">(<span class="type">int</span> callbackType, Runnable action, Object token)</span> &#123;</span><br><span class="line">    <span class="comment">// Add callback to queue</span></span><br><span class="line">    mCallbackQueues[callbackType].addCallbackLocked(action, token);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (callbackType == CALLBACK_TRAVERSAL) &#123;</span><br><span class="line">        <span class="comment">// If it&#x27;s UI traversal callback, immediately request Vsync</span></span><br><span class="line">        scheduleFrameLocked(now);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">scheduleFrameLocked</span><span class="params">(<span class="type">long</span> now)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!mFrameScheduled) &#123;</span><br><span class="line">        mFrameScheduled = <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">// Key: Request Vsync signal from system</span></span><br><span class="line">        mDisplayEventReceiver.scheduleVsync();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="How-Main-Thread-Listens-for-Vsync-Signals"><a href="#How-Main-Thread-Listens-for-Vsync-Signals" class="headerlink" title="How Main Thread Listens for Vsync Signals"></a>How Main Thread Listens for Vsync Signals</h3><p>The application main thread listens for Vsync signals through <code>DisplayEventReceiver</code>. This process involves several key steps:</p>
<p><strong>1. Establish Connection</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// frameworks/base/core/java/android/view/Choreographer.java</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">FrameDisplayEventReceiver</span> <span class="keyword">extends</span> <span class="title class_">DisplayEventReceiver</span></span><br><span class="line">        <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FrameDisplayEventReceiver</span><span class="params">(Looper looper, <span class="type">int</span> vsyncSource)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(looper, vsyncSource);</span><br><span class="line">        <span class="comment">// Establish connection with SurfaceFlinger during construction</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2. Receive Vsync Signal</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onVsync</span><span class="params">(<span class="type">long</span> timestampNanos, <span class="type">long</span> physicalDisplayId, <span class="type">int</span> frame)</span> &#123;</span><br><span class="line">    <span class="comment">// Received Vsync signal, but note: doFrame is not executed directly here</span></span><br><span class="line">    mTimestampNanos = timestampNanos;</span><br><span class="line">    mFrame = frame;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Key: Post work to main thread&#x27;s MessageQueue</span></span><br><span class="line">    <span class="type">Message</span> <span class="variable">msg</span> <span class="operator">=</span> Message.obtain(mHandler, <span class="built_in">this</span>);</span><br><span class="line">    msg.setAsynchronous(<span class="literal">true</span>);  <span class="comment">// Set as asynchronous message, priority processing</span></span><br><span class="line">    mHandler.sendMessageAtTime(msg, timestampNanos / TimeUtils.NANOS_PER_MS);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// This is where the work for one frame actually begins</span></span><br><span class="line">    doFrame(mTimestampNanos, mFrame);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Several-Remaining-Questions"><a href="#Several-Remaining-Questions" class="headerlink" title="Several Remaining Questions"></a>Several Remaining Questions</h3><p><strong>Q1: Why not execute <code>doFrame()</code> directly in <code>onVsync()</code>?</strong><br><img src="/en/images/Android-Perfetto-08-Vsync/image-20250918221936675.png" alt="image-20250918221936675"></p>
<ul>
<li>Thread boundary: <code>onVsync()</code> may not be on the main thread, UI must execute on the main thread</li>
<li>Scheduling control: Precisely align execution moment through <code>sendMessageAtTime()</code></li>
<li>Queue semantics: Enter main thread MessageQueue, ensure coordination with other high-priority tasks</li>
</ul>
<p><strong>Q2: If Vsync message arrives but main thread is busy, will it be lost?</strong><br><img src="/en/images/Android-Perfetto-08-Vsync/image-20250918222045731.png" alt="image-20250918222045731"></p>
<ul>
<li>No. Vsync message waits for execution after queuing</li>
</ul>
<p><strong>Q3: Must CPU&#x2F;GPU complete within a single Vsync cycle?</strong> If any link exceeds 1 vsync, will it cause frame drops?</p>
<ul>
<li><p>Modern Android systems use multi-buffering (usually triple buffering) mechanism:</p>
<ul>
<li><p><strong>Application side</strong>: Front Buffer (displaying) + Back Buffer (rendering) + possible third Buffer</p>
</li>
<li><p><strong>SurfaceFlinger side</strong>: Also has similar buffering mechanism</p>
</li>
<li><p>This means even if an application’s某frame exceeds the Vsync cycle, it won’t necessarily drop frames immediately.</p>
</li>
</ul>
</li>
<li><p>GPU asynchronous pipeline; the key is whether <code>queueBuffer</code> catches up with SF composition window. Multi-buffering can mask single frame delays but may introduce additional latency. As shown in the figure below, both App-side BufferQueue and SurfaceFlinger-side Buffers are sufficient with redundancy, so no frames are dropped.</p>
</li>
<li><p>However, if the App hasn’t accumulated Buffers before, frame drops will still occur.</p>
</li>
</ul>
<p><img src="/en/images/Android-Perfetto-08-Vsync/image-20250918222258536.png" alt="image-20250918222258536"></p>
<p><strong>Q5: How do GPU and CPU coordinate?</strong>:</p>
<ul>
<li><p>GPU rendering is asynchronous, bringing additional complexity:</p>
<ul>
<li><strong>CPU works normally, GPU becomes bottleneck</strong>: Even if application main thread completes work within Vsync cycle, excessive GPU rendering time will still cause frame drops</li>
<li><strong>GPU Fence mechanism</strong>: <code>presentFence</code> is the key synchronization mechanism connecting GPU rendering and SurfaceFlinger composition. According to the system’s <code>Latch Unsignaled Buffers</code> strategy, SurfaceFlinger doesn’t always wait for GPU completion, but can “jump the gun” to start composition early, only waiting for fence signal when finally needing to use Buffer content, thus hiding latency.</li>
</ul>
<p><img src="/en/images/Android-Perfetto-08-Vsync/image-20250918222626100.png" alt="image-20250918222626100"></p>
</li>
</ul>
<p><strong>Q6: What is the real role of Vsync Phase (phase difference)?</strong>:</p>
<ul>
<li><strong>Improve touch responsiveness</strong>: By adjusting sf vsync’s phase difference, the time from when an application starts drawing to displaying on screen can be shortened from 3 Vsync cycles to 2 Vsync cycles. This is very important for interaction scenarios like touch response.</li>
<li><strong>Solve application drawing timeout issues</strong>: When application drawing times out, a reasonable sf phase difference can争取更多的处理时间 for the application, avoiding frame drops due to improper timing.</li>
<li>Understanding the system’s Vsync Offset configuration can be achieved by observing the VsyncWorkDuration metric in Perfetto.</li>
<li>The time period shown in the figure below is the app offset (13.3ms) configured on my phone</li>
</ul>
<p><img src="/en/images/Android-Perfetto-08-Vsync/image-20250918222707300.png" alt="image-20250918222707300"></p>
<h3 id="Technical-Implementation-of-Vsync-Offset"><a href="#Technical-Implementation-of-Vsync-Offset" class="headerlink" title="Technical Implementation of Vsync Offset"></a>Technical Implementation of Vsync Offset</h3><p>In the Android system, Vsync Offset is implemented through VsyncConfiguration:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// frameworks/native/services/surfaceflinger/Scheduler/VsyncConfiguration.cpp</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">VsyncConfiguration</span> &#123;</span><br><span class="line">    <span class="comment">// Application Vsync offset relative to hardware Vsync</span></span><br><span class="line">    <span class="type">nsecs_t</span> appOffset;</span><br><span class="line">    <span class="comment">// SurfaceFlinger Vsync offset relative to hardware Vsync</span></span><br><span class="line">    <span class="type">nsecs_t</span> sfOffset;</span><br><span class="line">    <span class="comment">// Early application Vsync offset (for special cases)</span></span><br><span class="line">    <span class="type">nsecs_t</span> appOffsetEarly;</span><br><span class="line">    <span class="comment">// Early SurfaceFlinger Vsync offset</span></span><br><span class="line">    <span class="type">nsecs_t</span> sfOffsetEarly;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>Key Concepts</strong>:</p>
<ul>
<li><code>appOffset</code>: Application Vsync time offset relative to hardware Vsync</li>
<li><code>sfOffset</code>: SurfaceFlinger Vsync time offset relative to hardware Vsync</li>
<li><code>Vsync Offset = sfOffset - appOffset</code>: Time difference between when App and SurfaceFlinger receive signals</li>
</ul>
<h3 id="Actual-Optimization-Effects"><a href="#Actual-Optimization-Effects" class="headerlink" title="Actual Optimization Effects"></a>Actual Optimization Effects</h3><p>Taking a 120Hz device as an example, the effect of configuring 3ms Offset:</p>
<p><strong>Without Offset (Traditional Method)</strong>:</p>
<ul>
<li>T0: Application and SurfaceFlinger receive Vsync simultaneously</li>
<li>T0+3ms: Application completes rendering</li>
<li>T0+8.333ms: Next Vsync, SurfaceFlinger starts composition</li>
<li>T0+16.666ms: User sees the image (total latency 16.666ms)</li>
</ul>
<p><strong>With Offset (Optimized Method)</strong>:</p>
<ul>
<li>T0+1ms: Application receives Vsync-app, starts rendering</li>
<li>T0+3ms: Application completes rendering, submits Buffer</li>
<li>T0+4ms: SurfaceFlinger receives Vsync-sf, immediately starts composition</li>
<li>T0+6ms: SurfaceFlinger completes composition</li>
<li>T0+8.333ms: User sees the image (total latency 8.333ms)</li>
</ul>
<p>Through reasonable Offset configuration, latency can be reduced from 16.666ms to 8.333ms, doubling response performance.</p>
<p><strong>Actual Time Budget Allocation</strong>:</p>
<p>Taking a 120Hz device as an example (8.333ms cycle):</p>
<ul>
<li><strong>Ideal case</strong>: Application 4ms + SurfaceFlinger 2ms + buffer 2.333ms</li>
<li><strong>But actually acceptable</strong>: Application 6ms + SurfaceFlinger 3ms (if there’s enough Buffer buffering)</li>
<li><strong>GPU limitation</strong>: On low-end devices, GPU rendering may need 10-15ms, becoming the real bottleneck</li>
</ul>
<p><strong>Real Causes of Frame Drops</strong>:</p>
<ol>
<li><strong>Application timeout + Buffer exhaustion</strong>: Continuous multiple frame timeouts lead to no available Buffers in BufferQueue</li>
<li><strong>GPU rendering timeout</strong>: Even if CPU work is normal, GPU rendering timeout will still cause frame drops</li>
<li><strong>SurfaceFlinger timeout</strong>: System-level composition timeout affects all applications</li>
<li><strong>System resource competition</strong>: CPU&#x2F;GPU&#x2F;memory and other resources occupied by other processes</li>
</ol>
<h2 id="Complete-Code-Flow-of-Vsync-Signals"><a href="#Complete-Code-Flow-of-Vsync-Signals" class="headerlink" title="Complete Code Flow of Vsync Signals"></a>Complete Code Flow of Vsync Signals</h2><p>The complete chain of Vsync signals from hardware to application layer is as follows.</p>
<h3 id="Native-Layer-Vsync-Signal-Generation-and-Management"><a href="#Native-Layer-Vsync-Signal-Generation-and-Management" class="headerlink" title="Native Layer: Vsync Signal Generation and Management"></a>Native Layer: Vsync Signal Generation and Management</h3><p><strong>Hardware Vsync Generation</strong></p>
<p>Vsync signals are initially generated by display hardware. At the HWC (Hardware Composer) level, hardware periodically generates Vsync interrupts:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hardware/interfaces/graphics/composer/2.1/utils/hwc2on1adapter/HWC2On1Adapter.cpp</span></span><br><span class="line"><span class="comment">// Note: This is a compatibility adapter from HWC 1.x to 2.x, modern devices typically use native HWC 2.x+</span></span><br><span class="line"><span class="comment">// Based on Android 16 AOSP latest code</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">HWC2On1Adapter::vsyncThread</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (!mVsyncEnded) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mVsyncEnabled) &#123;</span><br><span class="line">            <span class="type">const</span> <span class="keyword">auto</span> now = std::chrono::steady_clock::<span class="built_in">now</span>();</span><br><span class="line">            <span class="type">const</span> <span class="keyword">auto</span> vsyncPeriod = std::chrono::<span class="built_in">nanoseconds</span>(mVsyncPeriod);</span><br><span class="line">            <span class="type">const</span> <span class="keyword">auto</span> nextVsync = mLastVsync + vsyncPeriod;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (now &gt;= nextVsync) &#123;</span><br><span class="line">                <span class="comment">// Generate hardware Vsync timestamp</span></span><br><span class="line">                <span class="keyword">auto</span> timestamp = std::chrono::<span class="built_in">duration_cast</span>&lt;std::chrono::nanoseconds&gt;(</span><br><span class="line">                    nextVsync.<span class="built_in">time_since_epoch</span>()).<span class="built_in">count</span>();</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// Callback to SurfaceFlinger</span></span><br><span class="line">                <span class="keyword">if</span> (mVsyncCallback) &#123;</span><br><span class="line">                    mVsyncCallback-&gt;<span class="built_in">onVsync</span>(timestamp, mDisplayId);</span><br><span class="line">                &#125;</span><br><span class="line">                mLastVsync = nextVsync;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">microseconds</span>(<span class="number">100</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>VsyncController: Core Controller</strong></p>
<p>VsyncController is the brain of the entire Vsync system, receiving hardware Vsync and managing software prediction:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// frameworks/native/services/surfaceflinger/Scheduler/VsyncController.h</span></span><br><span class="line"><span class="comment">// Actual implementation usually in VSyncReactor.cpp</span></span><br><span class="line"><span class="comment">// Based on Android 16 AOSP latest code</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">VsyncController::onVsync</span><span class="params">(<span class="type">nsecs_t</span> timestamp, <span class="type">int32_t</span> hwcDisplayId)</span> </span>&#123;</span><br><span class="line">    <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mMutex)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Record hardware Vsync timestamp to tracker</span></span><br><span class="line">    mVsyncTracker-&gt;<span class="built_in">addVsyncTimestamp</span>(timestamp);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Check if more hardware Vsync samples needed to calibrate prediction model</span></span><br><span class="line">    <span class="keyword">if</span> (mVsyncTracker-&gt;<span class="built_in">needsMoreSamples</span>()) &#123;</span><br><span class="line">        <span class="comment">// Model still needs more samples, continue enabling hardware Vsync</span></span><br><span class="line">        <span class="built_in">ALOGV</span>(<span class="string">&quot;VsyncController: Need more samples, keeping HW Vsync enabled&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Model is stable, can disable hardware Vsync to save power</span></span><br><span class="line">        <span class="built_in">ALOGV</span>(<span class="string">&quot;VsyncController: Model stable, disabling HW Vsync&quot;</span>);</span><br><span class="line">        <span class="built_in">enableHardwareVsync</span>(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Notify all waiting clients</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; callback : mCallbacks) &#123;</span><br><span class="line">        callback-&gt;<span class="built_in">onVsync</span>(timestamp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">VsyncController::enableHardwareVsync</span><span class="params">(<span class="type">bool</span> enable)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mHwVsyncEnabled != enable) &#123;</span><br><span class="line">        mHwVsyncEnabled = enable;</span><br><span class="line">        <span class="comment">// Control hardware Vsync through HWC interface</span></span><br><span class="line">        mHwc.<span class="built_in">setVsyncEnabled</span>(mDisplayId, enable);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// This state change can be seen in Perfetto trace</span></span><br><span class="line">        <span class="built_in">ATRACE_INT</span>(<span class="string">&quot;HW_VSYNC&quot;</span>, enable ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>VsyncDispatch: Signal Distribution Mechanism</strong></p>
<p>VsyncDispatch is responsible for precisely distributing Vsync signals to different consumers, each consumer can have different trigger times:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// frameworks/native/services/surfaceflinger/Scheduler/VSyncDispatch.h</span></span><br><span class="line"><span class="comment">// Actual implementation in VSyncDispatchTimerQueue.cpp</span></span><br><span class="line"><span class="comment">// Based on Android 16 AOSP latest code</span></span><br><span class="line"><span class="function">VsyncDispatch::CallbackToken <span class="title">VsyncDispatch::registerCallback</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        Callback callback, std::string callbackName)</span> </span>&#123;</span><br><span class="line">    <span class="function">std::lock_guard&lt;<span class="title">decltype</span><span class="params">(mMutex)</span>&gt; <span class="title">lock</span><span class="params">(mMutex)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Generate unique token for each callback</span></span><br><span class="line">    <span class="keyword">auto</span> token = <span class="built_in">CallbackToken</span>(mCallbackMap.<span class="built_in">size</span>());</span><br><span class="line">    mCallbackMap[token] = std::<span class="built_in">make_unique</span>&lt;CallbackEntry&gt;(</span><br><span class="line">        std::<span class="built_in">move</span>(callback), std::<span class="built_in">move</span>(callbackName));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> token;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">nsecs_t</span> <span class="title">VsyncDispatch::schedule</span><span class="params">(CallbackToken token, </span></span></span><br><span class="line"><span class="params"><span class="function">                               <span class="type">nsecs_t</span> workDuration, </span></span></span><br><span class="line"><span class="params"><span class="function">                               <span class="type">nsecs_t</span> earliestVsync)</span> </span>&#123;</span><br><span class="line">    <span class="function">std::lock_guard&lt;<span class="title">decltype</span><span class="params">(mMutex)</span>&gt; <span class="title">lock</span><span class="params">(mMutex)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">auto</span> it = mCallbackMap.<span class="built_in">find</span>(token);</span><br><span class="line">    <span class="keyword">if</span> (it == mCallbackMap.<span class="built_in">end</span>()) &#123;</span><br><span class="line">        <span class="keyword">return</span> kInvalidTime;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Calculate target Vsync time</span></span><br><span class="line">    <span class="keyword">auto</span> targetVsync = mVsyncTracker-&gt;<span class="built_in">nextVsyncTime</span>(earliestVsync);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Calculate wakeup time = target Vsync - work duration</span></span><br><span class="line">    <span class="keyword">auto</span> wakeupTime = targetVsync - workDuration;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// If wakeup time has passed, push to next Vsync</span></span><br><span class="line">    <span class="keyword">auto</span> now = <span class="built_in">systemTime</span>(SYSTEM_TIME_MONOTONIC);</span><br><span class="line">    <span class="keyword">if</span> (wakeupTime &lt; now) &#123;</span><br><span class="line">        targetVsync = mVsyncTracker-&gt;<span class="built_in">nextVsyncTime</span>(targetVsync + <span class="number">1</span>);</span><br><span class="line">        wakeupTime = targetVsync - workDuration;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Set callback trigger time</span></span><br><span class="line">    it-&gt;second-&gt;wakeupTime = wakeupTime;</span><br><span class="line">    it-&gt;second-&gt;targetVsync = targetVsync;</span><br><span class="line">    it-&gt;second-&gt;workDuration = workDuration;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Reschedule timer</span></span><br><span class="line">    <span class="built_in">reschedule</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> targetVsync;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">VsyncDispatch::reschedule</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Find earliest callback that needs to trigger</span></span><br><span class="line">    <span class="type">nsecs_t</span> nextWakeup = std::numeric_limits&lt;<span class="type">nsecs_t</span>&gt;::<span class="built_in">max</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; [token, entry] : mCallbackMap) &#123;</span><br><span class="line">        <span class="keyword">if</span> (entry-&gt;wakeupTime &gt; <span class="number">0</span> &amp;&amp; entry-&gt;wakeupTime &lt; nextWakeup) &#123;</span><br><span class="line">            nextWakeup = entry-&gt;wakeupTime;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (nextWakeup != std::numeric_limits&lt;<span class="type">nsecs_t</span>&gt;::<span class="built_in">max</span>()) &#123;</span><br><span class="line">        <span class="comment">// Set timer to trigger at nextWakeup time</span></span><br><span class="line">        mTimeKeeper-&gt;<span class="built_in">alarmAt</span>(std::<span class="built_in">bind</span>(&amp;VsyncDispatch::timerCallback, <span class="keyword">this</span>), nextWakeup);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">VsyncDispatch::timerCallback</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;std::pair&lt;CallbackToken, CallbackEntry*&gt;&gt; firedCallbacks;</span><br><span class="line">    </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">std::lock_guard&lt;<span class="title">decltype</span><span class="params">(mMutex)</span>&gt; <span class="title">lock</span><span class="params">(mMutex)</span></span>;</span><br><span class="line">        <span class="keyword">auto</span> now = <span class="built_in">systemTime</span>(SYSTEM_TIME_MONOTONIC);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Find all callbacks that should trigger</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; [token, entry] : mCallbackMap) &#123;</span><br><span class="line">            <span class="keyword">if</span> (entry-&gt;wakeupTime &gt; <span class="number">0</span> &amp;&amp; now &gt;= entry-&gt;wakeupTime) &#123;</span><br><span class="line">                firedCallbacks.<span class="built_in">push_back</span>(&#123;token, entry.<span class="built_in">get</span>()&#125;);</span><br><span class="line">                entry-&gt;wakeupTime = <span class="number">0</span>; <span class="comment">// Reset</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Execute callbacks outside lock to avoid deadlock</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; [token, entry] : firedCallbacks) &#123;</span><br><span class="line">        entry-&gt;<span class="built_in">callback</span>(entry-&gt;targetVsync, entry-&gt;wakeupTime);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>EventThread: Connecting Native and Framework</strong></p>
<p>EventThread is the bridge connecting Native layer Vsync system and Framework layer:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// frameworks/native/services/surfaceflinger/Scheduler/EventThread.cpp</span></span><br><span class="line">EventThread::<span class="built_in">EventThread</span>(std::unique_ptr&lt;VSyncSource&gt; vsyncSource,</span><br><span class="line">                        std::unique_ptr&lt;InterceptVSyncCallback&gt; interceptVSyncCallback,</span><br><span class="line">                        <span class="type">const</span> <span class="type">char</span>* threadName)</span><br><span class="line">    : <span class="built_in">mVSyncSource</span>(std::<span class="built_in">move</span>(vsyncSource))</span><br><span class="line">    , <span class="built_in">mInterceptVSyncCallback</span>(std::<span class="built_in">move</span>(interceptVSyncCallback))</span><br><span class="line">    , <span class="built_in">mThreadName</span>(threadName) &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Register callback with VsyncDispatch</span></span><br><span class="line">    mVSyncSource-&gt;<span class="built_in">setCallback</span>(<span class="keyword">this</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Start EventThread thread</span></span><br><span class="line">    mThread = std::<span class="built_in">thread</span>([<span class="keyword">this</span>] &#123; <span class="built_in">threadMain</span>(); &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">EventThread::threadMain</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mMutex)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (mKeepRunning) &#123;</span><br><span class="line">        <span class="comment">// Wait for Vsync events or connection changes</span></span><br><span class="line">        mCondition.<span class="built_in">wait</span>(lock, [<span class="keyword">this</span>] &#123;</span><br><span class="line">            <span class="keyword">return</span> !mPendingEvents.<span class="built_in">empty</span>() || !mKeepRunning;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Process all pending events</span></span><br><span class="line">        <span class="keyword">auto</span> pendingEvents = std::<span class="built_in">move</span>(mPendingEvents);</span><br><span class="line">        lock.<span class="built_in">unlock</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; event : pendingEvents) &#123;</span><br><span class="line">            <span class="comment">// Distribute to all connected clients</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; connection : mConnections) &#123;</span><br><span class="line">                <span class="keyword">if</span> (connection-&gt;vsyncRequest != VSyncRequest::None) &#123;</span><br><span class="line">                    connection-&gt;<span class="built_in">postEvent</span>(event);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        lock.<span class="built_in">lock</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">EventThread::onVSyncEvent</span><span class="params">(<span class="type">nsecs_t</span> timestamp, <span class="type">int32_t</span> displayId)</span> </span>&#123;</span><br><span class="line">    <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mMutex)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Create Vsync event</span></span><br><span class="line">    DisplayEventReceiver::Event event;</span><br><span class="line">    event.header.type = DisplayEventReceiver::DISPLAY_EVENT_VSYNC;</span><br><span class="line">    event.header.id = displayId;</span><br><span class="line">    event.header.timestamp = timestamp;</span><br><span class="line">    event.vsync.count = ++mVSyncCount;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Add to pending events queue</span></span><br><span class="line">    mPendingEvents.<span class="built_in">push_back</span>(event);</span><br><span class="line">    mCondition.<span class="built_in">notify_all</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Framework-Layer-Vsync-Signal-Reception-and-Processing"><a href="#Framework-Layer-Vsync-Signal-Reception-and-Processing" class="headerlink" title="Framework Layer: Vsync Signal Reception and Processing"></a>Framework Layer: Vsync Signal Reception and Processing</h3><p><strong>DisplayEventReceiver: Bridge Between Java and Native</strong></p>
<p>DisplayEventReceiver is the key component for Framework layer to receive Vsync signals:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// frameworks/base/core/jni/android_view_DisplayEventReceiver.cpp</span></span><br><span class="line"><span class="function"><span class="type">static</span> jlong <span class="title">nativeInit</span><span class="params">(JNIEnv* env, jclass clazz, jobject receiverWeak,</span></span></span><br><span class="line"><span class="params"><span class="function">        jobject messageQueueObj, jint vsyncSource, jint configChanged)</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Get Java layer&#x27;s MessageQueue</span></span><br><span class="line">    sp&lt;MessageQueue&gt; messageQueue = <span class="built_in">android_os_MessageQueue_getMessageQueue</span>(env, messageQueueObj);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Create Native layer&#x27;s DisplayEventReceiver</span></span><br><span class="line">    sp&lt;NativeDisplayEventReceiver&gt; receiver = <span class="keyword">new</span> <span class="built_in">NativeDisplayEventReceiver</span>(</span><br><span class="line">        env, receiverWeak, messageQueue, vsyncSource, configChanged);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Register to EventThread</span></span><br><span class="line">    <span class="type">status_t</span> status = receiver-&gt;<span class="built_in">initialize</span>();</span><br><span class="line">    <span class="keyword">if</span> (status) &#123;</span><br><span class="line">        <span class="built_in">ALOGE</span>(<span class="string">&quot;Failed to initialize display event receiver, status=%d&quot;</span>, status);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    receiver-&gt;<span class="built_in">incStrong</span>(gDisplayEventReceiverClassInfo.clazz);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">reinterpret_cast</span>&lt;jlong&gt;(receiver.<span class="built_in">get</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NativeDisplayEventReceiver</span> : <span class="keyword">public</span> DisplayEventReceiver, <span class="keyword">public</span> MessageHandler &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">NativeDisplayEventReceiver</span>(JNIEnv* env, jobject receiverWeak, </span><br><span class="line">                              <span class="type">const</span> sp&lt;MessageQueue&gt;&amp; messageQueue,</span><br><span class="line">                              jint vsyncSource, jint configChanged)</span><br><span class="line">        : <span class="built_in">DisplayEventReceiver</span>(<span class="built_in">static_cast</span>&lt;ISurfaceComposer::VsyncSource&gt;(vsyncSource),</span><br><span class="line">                             <span class="built_in">static_cast</span>&lt;ISurfaceComposer::ConfigChanged&gt;(configChanged))</span><br><span class="line">        , <span class="built_in">mReceiverWeakGlobal</span>(env-&gt;<span class="built_in">NewGlobalWeakRef</span>(receiverWeak))</span><br><span class="line">        , <span class="built_in">mMessageQueue</span>(messageQueue) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Callback when Vsync event arrives</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">onVsync</span><span class="params">(<span class="type">nsecs_t</span> timestamp, <span class="type">nsecs_t</span> physicalDisplayId, <span class="type">uint32_t</span> count)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="built_in">ALOGV</span>(<span class="string">&quot;NativeDisplayEventReceiver: onVsync timestamp=%lld&quot;</span>, (<span class="type">long</span> <span class="type">long</span>)timestamp);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Save event and post to MessageQueue</span></span><br><span class="line">        mTimestamp = timestamp;</span><br><span class="line">        mDisplayId = physicalDisplayId;</span><br><span class="line">        mCount = count;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Send message to Java layer&#x27;s MessageQueue</span></span><br><span class="line">        mMessageQueue-&gt;<span class="built_in">getLooper</span>()-&gt;<span class="built_in">sendMessage</span>(<span class="keyword">this</span>, <span class="built_in">Message</span>(MSG_VSYNC));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MessageHandler implementation, executes in Java layer Looper</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">handleMessage</span><span class="params">(<span class="type">const</span> Message&amp; message)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (message.what) &#123;</span><br><span class="line">        <span class="keyword">case</span> MSG_VSYNC:</span><br><span class="line">            <span class="comment">// Call Java layer&#x27;s onVsync method</span></span><br><span class="line">            <span class="built_in">dispatchVsync</span>(mTimestamp, mDisplayId, mCount);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">dispatchVsync</span><span class="params">(<span class="type">nsecs_t</span> timestamp, <span class="type">nsecs_t</span> displayId, <span class="type">uint32_t</span> count)</span> </span>&#123;</span><br><span class="line">        JNIEnv* env = AndroidRuntime::<span class="built_in">getJNIEnv</span>();</span><br><span class="line">        </span><br><span class="line">        jobject receiverObj = env-&gt;<span class="built_in">NewLocalRef</span>(mReceiverWeakGlobal);</span><br><span class="line">        <span class="keyword">if</span> (receiverObj) &#123;</span><br><span class="line">            <span class="comment">// Call Java layer DisplayEventReceiver.onVsync()</span></span><br><span class="line">            env-&gt;<span class="built_in">CallVoidMethod</span>(receiverObj, gDisplayEventReceiverClassInfo.onVsync,</span><br><span class="line">                    <span class="built_in">ns2ms</span>(timestamp), displayId, count);</span><br><span class="line">            env-&gt;<span class="built_in">DeleteLocalRef</span>(receiverObj);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>Vsync Processing in Choreographer</strong></p>
<p>In the Java layer, Choreographer’s FrameDisplayEventReceiver is responsible for handling Vsync signals:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// frameworks/base/core/java/android/view/Choreographer.java</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">FrameDisplayEventReceiver</span> <span class="keyword">extends</span> <span class="title class_">DisplayEventReceiver</span></span><br><span class="line">        <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> mHavePendingVsync;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> mTimestampNanos;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> mFrame;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FrameDisplayEventReceiver</span><span class="params">(Looper looper, <span class="type">int</span> vsyncSource)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(looper, vsyncSource);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Native layer calls back here</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onVsync</span><span class="params">(<span class="type">long</span> timestampNanos, <span class="type">int</span> builtInDisplayId, <span class="type">int</span> frame)</span> &#123;</span><br><span class="line">        <span class="comment">// Check for duplicate Vsync (defensive programming)</span></span><br><span class="line">        <span class="keyword">if</span> (mHavePendingVsync) &#123;</span><br><span class="line">            Log.w(TAG, <span class="string">&quot;Already have a pending vsync event. There should only be one&quot;</span></span><br><span class="line">                    + <span class="string">&quot; at a time.&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            mHavePendingVsync = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Save Vsync information</span></span><br><span class="line">        mTimestampNanos = timestampNanos;</span><br><span class="line">        mFrame = frame;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Key: Post processing work to main thread&#x27;s MessageQueue</span></span><br><span class="line">        <span class="comment">// Note using timestampNanos as execution time here</span></span><br><span class="line">        <span class="type">Message</span> <span class="variable">msg</span> <span class="operator">=</span> Message.obtain(mHandler, <span class="built_in">this</span>);</span><br><span class="line">        msg.setAsynchronous(<span class="literal">true</span>); <span class="comment">// Asynchronous message, higher priority</span></span><br><span class="line">        mHandler.sendMessageAtTime(msg, timestampNanos / TimeUtils.NANOS_PER_MS);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Runnable interface implementation, executes on main thread</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        mHavePendingVsync = <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">// Start processing one frame&#x27;s work</span></span><br><span class="line">        doFrame(mTimestampNanos, mFrame);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Choreographer&#x27;s core logic for processing one frame (simplified excerpt, see AOSP source code for details)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">doFrame</span><span class="params">(<span class="type">long</span> frameTimeNanos, <span class="type">int</span> frame)</span> &#123;</span><br><span class="line">    <span class="comment">// ... omit pre-checks and time correction ...</span></span><br><span class="line">    <span class="comment">// Execute five types of callbacks in order</span></span><br><span class="line">    doCallbacks(Choreographer.CALLBACK_INPUT, frameTimeNanos);</span><br><span class="line">    doCallbacks(Choreographer.CALLBACK_ANIMATION, frameTimeNanos);</span><br><span class="line">    doCallbacks(Choreographer.CALLBACK_INSETS_ANIMATION, frameTimeNanos);</span><br><span class="line">    doCallbacks(Choreographer.CALLBACK_TRAVERSAL, frameTimeNanos);</span><br><span class="line">    doCallbacks(Choreographer.CALLBACK_COMMIT, frameTimeNanos);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Key-Timing-Point-Analysis"><a href="#Key-Timing-Point-Analysis" class="headerlink" title="Key Timing Point Analysis"></a>Key Timing Point Analysis</h3><p>Through the above code flow, we can see the complete timing chain:</p>
<ol>
<li><strong>HWC generates hardware interrupt</strong> → <code>VsyncController::onVsync()</code></li>
<li><strong>VsyncController processing</strong> → <code>VsyncDispatch::schedule()</code></li>
<li><strong>VsyncDispatch distribution</strong> → <code>EventThread::onVSyncEvent()</code></li>
<li><strong>EventThread notification</strong> → <code>NativeDisplayEventReceiver::onVsync()</code></li>
<li><strong>Native passes to Java</strong> → <code>FrameDisplayEventReceiver::onVsync()</code></li>
<li><strong>Main thread processing</strong> → <code>Choreographer::doFrame()</code></li>
</ol>
<p>Each link has different responsibilities and optimization points. Understanding the complete process helps analyze Vsync-related performance issues in Perfetto.</p>
<h3 id="FrameTimeline"><a href="#FrameTimeline" class="headerlink" title="FrameTimeline"></a>FrameTimeline</h3><p>Both App and SurfaceFlinger have FrameTimeline</p>
<p><img src="/en/images/Android-Perfetto-08-Vsync/image-20250918223035361.png" alt="image-20250918223035361"></p>
<ul>
<li><strong>Tracks</strong>: <code>Expected Timeline</code>, <code>Actual Timeline</code></li>
<li><strong>PresentType&#x2F;JankType</strong>:<ul>
<li>PresentType indicates how this frame was presented (e.g., On-time, Late), JankType indicates jank type source</li>
<li>Common JankType: <code>AppDeadlineMissed</code>, <code>BufferStuffing</code>, <code>SfCpuDeadlineMissed</code>, <code>SfGpuDeadlineMissed</code>, etc.</li>
</ul>
</li>
<li><strong>Operation Steps (Perfetto UI)</strong>:<ol>
<li>Select target <code>Surface/Layer</code> in application process or filter using FrameToken</li>
<li>Align Expected with Actual, view offset and color coding</li>
<li>Drill up: <code>Choreographer#doFrame</code>, <code>RenderThread</code>, <code>queueBuffer</code>, <code>acquire/present_fence</code></li>
</ol>
</li>
<li><strong>Avoiding Misjudgment</strong>:<ul>
<li>Judging frame drops solely by <code>doFrame</code> duration is unreliable; use FrameTimeline’s PresentType&#x2F;JankType as standard</li>
<li>Multi-buffering may mask single frame timeout, need to look at consecutive frames and Buffer availability</li>
</ul>
</li>
</ul>
<h3 id="Impact-of-Refresh-Rate-x2F-Display-Mode-x2F-VRR-on-Vsync-and-Offset-x2F-Prediction"><a href="#Impact-of-Refresh-Rate-x2F-Display-Mode-x2F-VRR-on-Vsync-and-Offset-x2F-Prediction" class="headerlink" title="Impact of Refresh Rate&#x2F;Display Mode&#x2F;VRR on Vsync and Offset&#x2F;Prediction"></a>Impact of Refresh Rate&#x2F;Display Mode&#x2F;VRR on Vsync and Offset&#x2F;Prediction</h3><ul>
<li><strong>Mode Switching</strong>: Refresh rate changes will reconfigure <code>VsyncConfiguration</code>, affecting app&#x2F;sf Offset and prediction model;<ul>
<li>Perfetto: Check <code>display mode change</code> events and subsequent <code>vsync</code> interval changes</li>
</ul>
</li>
<li><strong>VRR (Variable Refresh Rate)</strong>: Target cycle is not constant, software prediction relies more on present_fence feedback calibration;<ul>
<li>Perfetto: Observe <code>vsync</code> interval distribution and <code>present_fence</code> deviation</li>
</ul>
</li>
<li><strong>Multi-display&#x2F;External Display</strong>: Different <code>physicalDisplayId</code> vsync sources are independent, note app&#x2F;sf&#x2F;appSf selection and alignment;<ul>
<li>Perfetto: Filter related Counter&#x2F;Slice by display ID</li>
</ul>
</li>
</ul>
<h3 id="Perfetto-Practice-Checklist-Recommended-Viewing-Order"><a href="#Perfetto-Practice-Checklist-Recommended-Viewing-Order" class="headerlink" title="Perfetto Practice Checklist (Recommended Viewing Order)"></a>Perfetto Practice Checklist (Recommended Viewing Order)</h3><ol>
<li><strong>Vsync Signal and Cycle</strong><ul>
<li>Whether <code>vsync-app / vsync-sf / vsync-appSf</code> intervals are stable (60&#x2F;90&#x2F;120Hz corresponding cycles)</li>
<li>Whether there are abnormally dense&#x2F;sparse Vsyncs (prediction jitter)<br><img src="/en/images/Android-Perfetto-08-Vsync/image-20250918223148748.png" alt="image-20250918223148748"></li>
</ul>
</li>
<li><strong>Vsync Phase Difference Configuration</strong><ul>
<li>Whether <code>VsyncWorkDuration</code> matches device’s expected app&#x2F;sf Offset</li>
<li>Whether app and sf sequence matches “draw first then composite” strategy<br><img src="/en/images/Android-Perfetto-08-Vsync/image-20250918222707300.png" alt="image-20250918222707300"></li>
</ul>
</li>
<li><strong>FrameTimeline Interpretation</strong><ul>
<li>First look at <code>PresentType</code>, then <code>JankType</code>; confirm whether it’s app or SF&#x2F;GPU side issue</li>
<li>Select target Surface&#x2F;FrameToken to locate specific frame<br><img src="/en/images/Android-Perfetto-08-Vsync/image-20250918223220718.png" alt="image-20250918223220718"></li>
</ul>
</li>
<li><strong>Application Main Thread and Render Thread</strong><ul>
<li><code>Choreographer#doFrame</code> each stage duration (Input&#x2F;Animation&#x2F;Traversal)</li>
<li>Whether <code>RenderThread</code>‘s <code>syncAndDrawFrame/DrawFrame</code> duration is abnormal<br><img src="/en/images/Android-Perfetto-08-Vsync/image-20250918223340940.png" alt="image-20250918223340940"></li>
</ul>
</li>
<li><strong>BufferQueue and Fence</strong><ul>
<li>Producer: After RenderThread queueBuffer, this Buffer is marked as consumable, and can be consumed by sf after one Transaction. Just after queueBuffer, the Buffer still needs GPU to actually render, here Fence is used to track GPU execution time. SF also needs to check this Fence to decide whether this Buffer is Ready (new version SF has a property value configuration, can also not wait for this Fence, wait until actual composition time to check).<br><img src="/en/images/Android-Perfetto-08-Vsync/image-20250918224205093.png" alt="image-20250918224205093"></li>
<li>Consumer SF and BufferTX: SF as Buffer consumer, will take a Buffer for composition when vsync arrives. Here App’s Buffer exists with the name BufferTX-xxxx. The figure below shows that each time SF takes a Buffer, BufferTX count decreases by 1, which is normal. If BufferTX is 0, it means App didn’t send Buffer up in time, SF also stops composition, which will cause jank (of course if there are multiple output sources simultaneously, SF will take other Buffers, but for the App it’s still jank)<br><img src="/en/images/Android-Perfetto-08-Vsync/image-20250918223441117.png" alt="image-20250918223441117"></li>
</ul>
</li>
<li><strong>Composition Strategy and Display</strong><ul>
<li>Whether SF frequently goes ClientComposition; whether HWC validate&#x2F;present is abnormal</li>
<li>Whether there’s obvious prediction deviation during multi-display&#x2F;mode switching&#x2F;VRR<br><img src="/en/images/Android-Perfetto-08-Vsync/image-20250918223517315.png" alt="image-20250918223517315"></li>
</ul>
</li>
<li><strong>Resources and Other Interference</strong><ul>
<li>CPU competition (big core occupation), GPU busy, IO&#x2F;memory jitter (GC&#x2F;compaction)</li>
<li>Whether other foreground apps&#x2F;system services occupy key resources<br><img src="/en/images/Android-Perfetto-08-Vsync/image-20250918223532482.png" alt="image-20250918223532482"></li>
</ul>
</li>
</ol>
<p><a id="refs"></a></p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol>
<li><a target="_blank" rel="noopener" href="https://source.android.com/docs/core/graphics">Android Graphics Architecture</a></li>
<li><a target="_blank" rel="noopener" href="https://source.android.com/docs/core/graphics/implement-vsync">VSYNC Implementation Guide</a></li>
<li><a target="_blank" rel="noopener" href="https://source.android.com/docs/core/graphics/frame-pacing">Frame Pacing</a></li>
<li><a target="_blank" rel="noopener" href="https://perfetto.dev/docs/">Perfetto Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://www.androidperformance.com/en/2025/03/26/Android-Perfetto-05-Chorergrapher/">Android Perfetto Series 5: Android App Rendering Flow Based on Choreographer</a></li>
<li><a target="_blank" rel="noopener" href="https://www.androidperformance.com/en/2025/04/26/Android-Perfetto-06-Why-120Hz/">Android Perfetto Series 6: Why 120Hz? Advantages and Challenges of High Refresh Rates</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1905184">Vsync offset Related Technical Analysis</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/learnframework/article/details/133964332">Android 13&#x2F;14 High Version SurfaceFlinger VSYNC-app&#x2F;VSYNC-appSf&#x2F;VSYNC-sf Analysis</a></li>
</ol>
<p><a id="about"></a></p>
<h1 id="About-Me-amp-amp-Blog"><a href="#About-Me-amp-amp-Blog" class="headerlink" title="About Me &amp;&amp; Blog"></a>About Me &amp;&amp; Blog</h1><p>Below is a personal introduction and related links. I look forward to communicating with you all. When three people walk together, one of them can be my teacher!</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://www.androidperformance.com/about/">Blogger Personal Introduction</a>: Contains personal WeChat and WeChat group links.</li>
<li><a target="_blank" rel="noopener" href="https://www.androidperformance.com/2019/12/01/BlogMap/">Blog Content Navigation</a>: A navigation of personal blog content.</li>
<li><a href="https://androidperformance.com/2018/05/07/Android-performance-optimization-skills-and-tools/">Excellent Blog Articles Collected and Organized by Individuals - Must-Know for Android Performance Optimization</a>: Welcome everyone to recommend yourself and recommend (WeChat private chat is fine)</li>
<li><a target="_blank" rel="noopener" href="https://www.androidperformance.com/2023/12/30/the-performance/">Android Performance Optimization Knowledge Planet</a>: Welcome to join, thanks for support~</li>
</ol>
<blockquote>
<p><strong>One person can go faster, a group of people can go further</strong></p>
</blockquote>
<p><img src="/en/images/WechatIMG581.png" alt="WeChat QR Code"></p>

    </article>
    <!-- license -->
        <div class="license-wrapper">
            <p>Author：<a href="https://androidperformance.com/en">Gracker</a>
            <p>Link：<a href="https://androidperformance.com/en/2025/08/05/Android-Perfetto-08-Vsync/">https://androidperformance.com/en/2025/08/05/Android-Perfetto-08-Vsync/</a>
            <p>Publish date：<a href="https://androidperformance.com/en/2025/08/05/Android-Perfetto-08-Vsync/">August 5th 2025, 10:15:30 am</a>
            <p>Update date：<a href="https://androidperformance.com/en/2025/08/05/Android-Perfetto-08-Vsync/">January 11th 2026, 8:56:53 pm</a>
            <p>License：This work is licensed under <a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a></p>
        </div>
    <!-- paginator -->
    <ul class="post-paginator">
        <li class="next">
                <div class="nextSlogan">Next Post</div>
                <a href="/en/2025/11/12/Android-Perfetto-09-CPU/" title="Android Perfetto Series 9: CPU Information Interpretation">
                    <div class="nextTitle">Android Perfetto Series 9: CPU Information Interpretation</div>
                </a>
        </li>
        <li class="previous">
                <div class="prevSlogan">Previous Post</div>
                <a href="/en/2025/08/02/Android-Perfetto-07-MainThread-And-RenderThread/" title="Android Perfetto Series 7: MainThread and RenderThread Deep Dive">
                    <div class="prevTitle">Android Perfetto Series 7: MainThread and RenderThread Deep Dive</div>
                </a>
        </li>
    </ul>
    <!-- comment -->
        <div class="post-comment">
            <!-- 来必力 City 版安装代码 -->

            
            
            
            <!-- utteranc评论 -->

            <!-- partial('_partial/comment/changyan') -->
            <!--PC版-->

            
            
            
        </div>
    <!-- timeliness note -->
    <!-- idea from: https://hexo.fluid-dev.com/posts/hexo-injector/#%E6%96%87%E7%AB%A0%E6%97%B6%E6%95%88%E6%80%A7%E6%8F%90%E7%A4%BA -->
    <!-- Mathjax -->
</main>

                <!-- profile -->
            </div>
            <footer class="footer footer-unloaded">
    <!-- social  -->
        <div class="social">
                            <a href="mailto:Dreamtale.jg@gmail.com" class="iconfont-archer email" title="email" ></a>
                <a href="https://github.com/gracker" class="iconfont-archer github" target="_blank" title="github"></a>
                <span class="iconfont-archer wechat" title="wechat">
                    <img class="profile-qr" src="/en/assets/Wechat.jpeg" />
                </span>
                <span class="iconfont-archer qq" title="qq">
                    <img class="profile-qr" src="/en/553000664" />
                </span>
                <a href="https://weibo.com/gracker520" class="iconfont-archer weibo" target="_blank" title="weibo"></a>
                <a href="https://www.zhihu.com/people/gracker" class="iconfont-archer zhihu" target="_blank" title="zhihu"></a>
                <a href="https://twitter.com/Gracker_Gao" class="iconfont-archer twitter" target="_blank" title="twitter"></a>
                <a href="https://juejin.im/user/557b0590e4b052e031453d76" class="iconfont-archer juejin" target="_blank" title="juejin"></a>
                <a href="https://www.youtube.com/@grackers" class="iconfont-archer youtube" target="_blank" title="youtube"></a>
                <a href="/en/atom.xml" class="iconfont-archer rss" target="_blank" title="rss"></a>

        </div>
    <!-- powered by Hexo  -->
    <div class="copyright">
        <span id="hexo-power">Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></span><span class="iconfont-archer power">&#xe635;</span><span id="theme-info">theme <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">Archer</a></span>
    </div>
    <!-- website approve for Chinese user -->
        <div class="website-approve">
                <span id="icp-approve" class="icp-approve">
                    <a href="https://beian.miit.gov.cn/" target="_blank">蜀 ICP 备 20016190 号</a>
                </span>
        </div>
</footer>

        </div>
        <!-- toc -->
            <div class="toc-wrapper toc-wrapper-loding" style=    top:50vh;
>
                <div class="toc-catalog">
                    <span class="iconfont-archer catalog-icon">&#xe613;</span><span>CATALOG</span>
                </div>
                <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Table-of-Contents"><span class="toc-number">1.</span> <span class="toc-text">Table of Contents</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Series-Catalog"><span class="toc-number"></span> <span class="toc-text">Series Catalog</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#What-is-Vsync"><span class="toc-number">1.</span> <span class="toc-text">What is Vsync</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#What-Problems-Does-Vsync-Solve"><span class="toc-number">1.1.</span> <span class="toc-text">What Problems Does Vsync Solve?</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Basic-Working-Principles-of-Vsync-in-Android"><span class="toc-number">2.</span> <span class="toc-text">Basic Working Principles of Vsync in Android</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Layered-Architecture-of-Vsync-Signals"><span class="toc-number">2.1.</span> <span class="toc-text">Layered Architecture of Vsync Signals</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Observing-Vsync-in-Perfetto"><span class="toc-number">3.</span> <span class="toc-text">Observing Vsync in Perfetto</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#How-Android-App-Frames-Work-Based-on-Vsync"><span class="toc-number">4.</span> <span class="toc-text">How Android App Frames Work Based on Vsync</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Process-Overview-In-Order"><span class="toc-number">4.1.</span> <span class="toc-text">Process Overview (In Order)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#When-Does-App-Request-Vsync-Signals"><span class="toc-number">4.2.</span> <span class="toc-text">When Does App Request Vsync Signals</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Complete-Process-of-App-Requesting-Vsync"><span class="toc-number">4.3.</span> <span class="toc-text">Complete Process of App Requesting Vsync</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#How-Main-Thread-Listens-for-Vsync-Signals"><span class="toc-number">4.4.</span> <span class="toc-text">How Main Thread Listens for Vsync Signals</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Several-Remaining-Questions"><span class="toc-number">4.5.</span> <span class="toc-text">Several Remaining Questions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Technical-Implementation-of-Vsync-Offset"><span class="toc-number">4.6.</span> <span class="toc-text">Technical Implementation of Vsync Offset</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Actual-Optimization-Effects"><span class="toc-number">4.7.</span> <span class="toc-text">Actual Optimization Effects</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Complete-Code-Flow-of-Vsync-Signals"><span class="toc-number">5.</span> <span class="toc-text">Complete Code Flow of Vsync Signals</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Native-Layer-Vsync-Signal-Generation-and-Management"><span class="toc-number">5.1.</span> <span class="toc-text">Native Layer: Vsync Signal Generation and Management</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Framework-Layer-Vsync-Signal-Reception-and-Processing"><span class="toc-number">5.2.</span> <span class="toc-text">Framework Layer: Vsync Signal Reception and Processing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Key-Timing-Point-Analysis"><span class="toc-number">5.3.</span> <span class="toc-text">Key Timing Point Analysis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FrameTimeline"><span class="toc-number">5.4.</span> <span class="toc-text">FrameTimeline</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Impact-of-Refresh-Rate-x2F-Display-Mode-x2F-VRR-on-Vsync-and-Offset-x2F-Prediction"><span class="toc-number">5.5.</span> <span class="toc-text">Impact of Refresh Rate&#x2F;Display Mode&#x2F;VRR on Vsync and Offset&#x2F;Prediction</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Perfetto-Practice-Checklist-Recommended-Viewing-Order"><span class="toc-number">5.6.</span> <span class="toc-text">Perfetto Practice Checklist (Recommended Viewing Order)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#References"><span class="toc-number">6.</span> <span class="toc-text">References</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#About-Me-amp-amp-Blog"><span class="toc-number"></span> <span class="toc-text">About Me &amp;&amp; Blog</span></a>
            </div>
        <!-- sidebar -->
        <div class="sidebar sidebar-hide">
    <ul class="sidebar-tabs sidebar-tabs-active-0">
        <li class="sidebar-tab-archives"><span class="iconfont-archer">&#xe67d;</span><span class="tab-name">Archive</span></li>
        <li class="sidebar-tab-tags"><span class="iconfont-archer">&#xe61b;</span><span class="tab-name">Tag</span></li>
        <li class="sidebar-tab-categories"><span class="iconfont-archer">&#xe666;</span><span class="tab-name">Cate</span></li>
    </ul>
    <div class="sidebar-content sidebar-content-show-archive">
        <div class="sidebar-panel-archives">
    <!-- 在 ejs 中将 archive 按照时间排序 -->
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    <div class="total-and-search">
        <div class="total-archive">
        Total : 121
        </div>
        <!-- search  -->
    </div>
    <div class="post-archive">
            <div class="archive-year"> 2025 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">11/16</span>
            <a class="archive-post-title" href="/en/2025/11/16/Android-Perfetto-10-Binder/">Android Perfetto Series 10: Binder Scheduling and Lock Contention</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/12</span>
            <a class="archive-post-title" href="/en/2025/11/12/Android-Perfetto-09-CPU/">Android Perfetto Series 9: CPU Information Interpretation</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/05</span>
            <a class="archive-post-title" href="/en/2025/08/05/Android-Perfetto-08-Vsync/">Android Perfetto Series 8: Understanding Vsync Mechanism and Performance Analysis</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/02</span>
            <a class="archive-post-title" href="/en/2025/08/02/Android-Perfetto-07-MainThread-And-RenderThread/">Android Perfetto Series 7: MainThread and RenderThread Deep Dive</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/26</span>
            <a class="archive-post-title" href="/en/2025/04/26/Android-Perfetto-06-Why-120Hz/">Android Perfetto Series 6: Why 120Hz? Advantages and Challenges</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">03/26</span>
            <a class="archive-post-title" href="/en/2025/03/26/Android-Perfetto-05-Chorergrapher/">Android Perfetto Series 5: Choreographer-based Rendering Flow</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/08</span>
            <a class="archive-post-title" href="/en/2025/02/08/Android-Perfetto-04-Open-Big-Trace-With-Command-Line/">Android Perfetto Series 4: Opening Large Traces via Command Line</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/08</span>
            <a class="archive-post-title" href="/en/2025/02/08/Android-ANR-02-How-to-analysis-ANR/">Android ANR Series 2: ANR Analysis Methodology and Key Logs</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/08</span>
            <a class="archive-post-title" href="/en/2025/02/08/Android-ANR-01-ANR-Design/">Android ANR Series 1: Understanding Android ANR Design Philosophy</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/08</span>
            <a class="archive-post-title" href="/en/2025/02/08/Android-ANR-03-ANR-Case-Share/">Android ANR Series 3 - ANR Case Studies</a>
        </li>
                </ul>
            <div class="archive-year"> 2024 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">05/21</span>
            <a class="archive-post-title" href="/en/2024/05/21/Android-Perfetto-01-What-is-perfetto/">Android Perfetto Series 1: Introduction to Perfetto</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/21</span>
            <a class="archive-post-title" href="/en/2024/05/21/Android-Perfetto-02-how-to-get-perfetto/">Android Perfetto Series 2: Capturing Perfetto Traces</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/21</span>
            <a class="archive-post-title" href="/en/2024/05/21/Android-Perfetto-03-how-to-analysis-perfetto/">Android Perfetto Series 3: Familiarizing with the Perfetto View</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">03/27</span>
            <a class="archive-post-title" href="/en/2024/03/27/Android-Perfetto-101/">Android Perfetto Series Catalog</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/01</span>
            <a class="archive-post-title" href="/en/2024/01/01/2023-review/">Reflections on 2023: Health, Career, and the Future</a>
        </li>
                </ul>
            <div class="archive-year"> 2023 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">12/30</span>
            <a class="archive-post-title" href="/en/2023/12/30/the-performance/">Introduction to The Android Performance Knowledge Planet</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/21</span>
            <a class="archive-post-title" href="/en/2023/08/21/the-performance-design-of-os/">Performance Considerations in Operating System Design</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/14</span>
            <a class="archive-post-title" href="/en/2023/05/14/bad-android-app-with-system-permissions/">Can an App Really Do Whatever It Wants With System Permissions?</a>
        </li>
                </ul>
            <div class="archive-year"> 2022 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">03/27</span>
            <a class="archive-post-title" href="/en/2022/03/27/the-performance-tea-part-01/">The Performance Community Tea Talk - Episode 1</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">03/13</span>
            <a class="archive-post-title" href="/en/2022/03/13/android-systrace-cpu-state-running/">Systrace Thread CPU State Analysis Tips - Running</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">03/13</span>
            <a class="archive-post-title" href="/en/2022/03/13/android-systrace-cpu-state-sleep/">Systrace Thread CPU State Analysis Tips - Sleep and Uninterruptible Sleep</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/21</span>
            <a class="archive-post-title" href="/en/2022/01/21/android-systrace-cpu-state-runnable/">Systrace Thread CPU State Analysis Tips - Runnable</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/07</span>
            <a class="archive-post-title" href="/en/2022/01/07/Techniques-Philosophy-and-Tools-for-Android-Performance-Optimization/">Techniques, Philosophy, and Tools for Android Performance Optimization</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/07</span>
            <a class="archive-post-title" href="/en/2022/01/07/The-Performace-1-Performance-Tools/">Android Performance Optimization: Techniques, Methods, and Tools</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/03</span>
            <a class="archive-post-title" href="/en/2022/01/03/2021-Review/">2021 Year in Review: Baby, Career, and Growth</a>
        </li>
                </ul>
            <div class="archive-year"> 2021 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">10/27</span>
            <a class="archive-post-title" href="/en/2021/10/27/if-i-write-a-book-about-performance/">What Should Be in a Book About Android Smoothness?</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">10/26</span>
            <a class="archive-post-title" href="/en/2021/10/26/build-android-12/">Android System Development Series (1): Downloading, Compiling, and Flashing Android 12</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/13</span>
            <a class="archive-post-title" href="/en/2021/09/13/android-systrace-Responsiveness-in-action-1/">Android Systrace Responsiveness in Action 1 - Understanding Responsiveness Principles</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/13</span>
            <a class="archive-post-title" href="/en/2021/09/13/android-systrace-Responsiveness-in-action-2/">Android Systrace Responsiveness in Action 2 - Responsiveness Analysis - Using App Startup as an Example</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/13</span>
            <a class="archive-post-title" href="/en/2021/09/13/android-systrace-Responsiveness-in-action-3/">Android Systrace Responsiveness in Action 3 - Extended Knowledge on Responsiveness</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/24</span>
            <a class="archive-post-title" href="/en/2021/04/24/android-systrace-smooth-in-action-2/">Android Systrace Smoothness in Action 2 - Case Analysis - MIUI Launcher Scroll Jank Analysis</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/24</span>
            <a class="archive-post-title" href="/en/2021/04/24/android-systrace-smooth-in-action-3/">Android Systrace Smoothness in Action 3 - FAQs During Jank Analysis</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/24</span>
            <a class="archive-post-title" href="/en/2021/04/24/android-systrace-smooth-in-action-1/">Android Systrace Smoothness in Action 1 - Understanding Jank Principles</a>
        </li>
                </ul>
            <div class="archive-year"> 2020 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">08/20</span>
            <a class="archive-post-title" href="/en/2020/08/20/weibo-imageload-opt-on-huawei/">Why is the Weibo Experience Better on Huawei? A Technical Analysis and Reflection</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/26</span>
            <a class="archive-post-title" href="/en/2020/05/26/samsung_crash/">An Incident Caused by a 'Leap' Month - Analysis of Samsung System Reboots</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/07</span>
            <a class="archive-post-title" href="/en/2020/05/07/Android-App-Chain-Wakeup/">Analysis of Android App Chain Wakeups</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/14</span>
            <a class="archive-post-title" href="/en/2020/02/14/Android-Systrace-SurfaceFlinger/">Android Systrace Basics - SurfaceFlinger Explained</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/03</span>
            <a class="archive-post-title" href="/en/2020/02/03/android-development-learning-path-2020-edition/">Android Developer Learning Path (2020 Edition)</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/28</span>
            <a class="archive-post-title" href="/en/2020/01/28/2020-read/">My 2020 Reading List</a>
        </li>
                </ul>
            <div class="archive-year"> 2019 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">12/21</span>
            <a class="archive-post-title" href="/en/2019/12/21/Android-Systrace-CPU/">Android Systrace Basics - CPU Info Interpretation</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">12/15</span>
            <a class="archive-post-title" href="/en/2019/12/15/Android-Systrace-Triple-Buffer/">Android Systrace Basics - Triple Buffer Explained</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">12/06</span>
            <a class="archive-post-title" href="/en/2019/12/06/Android-Systrace-Binder/">Android Systrace Basics - Binder and Lock Contention Explained</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">12/01</span>
            <a class="archive-post-title" href="/en/2019/12/01/BlogMap/">[Sticky] Blog Article Directory</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">12/01</span>
            <a class="archive-post-title" href="/en/2019/12/01/Android-Systrace-Vsync/">Android Systrace Basics - Vsync Explained</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/18</span>
            <a class="archive-post-title" href="/en/2019/11/18/Android-App-Lunch-Optimize/">Comprehensive Record of Android App Startup Optimization</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/18</span>
            <a class="archive-post-title" href="/en/2019/11/18/Android-App-Lunch-Optimize-NEW/">Complete Guide to Android App Startup Optimization</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/06</span>
            <a class="archive-post-title" href="/en/2019/11/06/Android-Systrace-MainThread-And-RenderThread/">Android Systrace Basics - MainThread and RenderThread Explained</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/04</span>
            <a class="archive-post-title" href="/en/2019/11/04/Android-Systrace-Input/">Android Systrace Basics - Input Interpretation</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">10/24</span>
            <a class="archive-post-title" href="/en/2019/10/24/Android-Background-Animation/">Analysis of 'Zombie Animations' in the Android Background</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">10/22</span>
            <a class="archive-post-title" href="/en/2019/10/22/Android-Choreographer/">Detailed Explanation of Android Rendering Mechanism Based on Choreographer</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/18</span>
            <a class="archive-post-title" href="/en/2019/09/18/Android-Jank-Due-To-Low-Memory/">Overview of Jank and Frame Drops in Android - Low Memory</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/17</span>
            <a class="archive-post-title" href="/en/2019/09/17/Android-Kill-Background-App-Debug/">Case Study: Debugging the Android Launcher Kill Problem</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/05</span>
            <a class="archive-post-title" href="/en/2019/09/05/Android-Jank-Due-To-App/">Overview of Jank and Frame Drops in Android - Application Layer</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/05</span>
            <a class="archive-post-title" href="/en/2019/09/05/Android-Jank-Due-To-System/">Overview of Jank and Frame Drops in Android - System Layer</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/05</span>
            <a class="archive-post-title" href="/en/2019/09/05/Android-Jank-Debug/">Overview of Jank and Frame Drops in Android - Methodology</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/01</span>
            <a class="archive-post-title" href="/en/2019/09/01/Android-Activity-Lunch-Mode/">A Detailed Guide to Activity Launch Modes in Android</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/27</span>
            <a class="archive-post-title" href="/en/2019/07/27/Android-Hardware-Layer-NEW/">Detailed Explanation of Hardware Layer in Android</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/27</span>
            <a class="archive-post-title" href="/en/2019/07/27/Android-Hardware-Layer/">A Deep Dive into Hardware Layers in Android</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/23</span>
            <a class="archive-post-title" href="/en/2019/07/23/Android-Systrace-Pre/">Android Systrace Basics - Prerequisites for Analyzing Systrace</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/29</span>
            <a class="archive-post-title" href="/en/2019/06/29/Android-Systrace-SystemServer/">Android Systrace Basics - SystemServer Explained</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/28</span>
            <a class="archive-post-title" href="/en/2019/05/28/Android-Systrace-About/">Android Systrace Basics - Introduction to Systrace</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/27</span>
            <a class="archive-post-title" href="/en/2019/05/27/why-60-fps/">Android Systrace Basics - Why 60 FPS?</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/26</span>
            <a class="archive-post-title" href="/en/2019/05/26/Android_Systrace_0/">Android Systrace -- Series Article Index</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/15</span>
            <a class="archive-post-title" href="/en/2019/05/15/90hz-on-android/">A New Era of Smoothness: Thoughts on 90Hz on Android</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/07</span>
            <a class="archive-post-title" href="/en/2019/04/07/Sharp-Tools/">Sharp Tools - Efficient Tool Recommendations</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/07</span>
            <a class="archive-post-title" href="/en/2019/04/07/liqi/">Liqi - High-Efficiency Tools Recommendation</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/21</span>
            <a class="archive-post-title" href="/en/2019/01/21/android-performance-case-jank-accessbility/">Case Analysis of System-wide Stutter Caused by Android Accessibility Service</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/12</span>
            <a class="archive-post-title" href="/en/2019/01/12/recommend-of-2018/">2018 Best Items Recommendations - A Reward for Your Hard Work</a>
        </li>
                </ul>
            <div class="archive-year"> 2018 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">11/01</span>
            <a class="archive-post-title" href="/en/2018/11/01/android-system-develop-0/">Setting Up the Android System Development Environment</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">10/25</span>
            <a class="archive-post-title" href="/en/2018/10/25/How-do-engineers-count-well/">Lu Qi: Besides Good Code, What Makes an Engineer Excellent?</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">10/01</span>
            <a class="archive-post-title" href="/en/2018/10/01/how-to-stop-sucking-and-be-awesome-instead-8/">The Programmer's Apprenticeship - 08: The Beauty of Reading</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/30</span>
            <a class="archive-post-title" href="/en/2018/09/30/how-to-stop-sucking-and-be-awesome-instead-7/">The Programmer's Apprenticeship - 07: Games and Programming</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/29</span>
            <a class="archive-post-title" href="/en/2018/09/29/how-to-stop-sucking-and-be-awesome-instead-6/">The Programmer's Apprenticeship - 06: All About the Internet</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/28</span>
            <a class="archive-post-title" href="/en/2018/09/28/how-to-stop-sucking-and-be-awesome-instead-5/">The Programmer's Apprenticeship - 05: Know Your Users</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/27</span>
            <a class="archive-post-title" href="/en/2018/09/27/how-to-stop-sucking-and-be-awesome-instead-4/">The Programmer's Apprenticeship - 04: Reflections on Testing</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/26</span>
            <a class="archive-post-title" href="/en/2018/09/26/how-to-stop-sucking-and-be-awesome-instead-3/">The Programmer's Apprenticeship - 03: Web Design Principles</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/20</span>
            <a class="archive-post-title" href="/en/2018/09/20/how-to-stop-sucking-and-be-awesome-instead-2/">The Programmer's Apprenticeship - 02: The Way of Programming</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/19</span>
            <a class="archive-post-title" href="/en/2018/09/19/how-to-stop-sucking-and-be-awesome-instead-1/">The Programmer's Apprenticeship - 01: The Art of Fighting Back</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">09/13</span>
            <a class="archive-post-title" href="/en/2018/09/13/android-memory/">Does the Android System Not Release Memory?</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/13</span>
            <a class="archive-post-title" href="/en/2018/08/13/Some-Thoughts-on-the-Fluency-of-Android/">Some Thoughts on Android System Fluency</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/20</span>
            <a class="archive-post-title" href="/en/2018/05/20/zhihu-startingwindow/">Zhihu: Save Your StartingWindow</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/07</span>
            <a class="archive-post-title" href="/en/2018/05/07/Android-performance-optimization-skills-and-tools/">[Sticky] Android Performance Optimization: Must-Know Skills and Tools</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/06</span>
            <a class="archive-post-title" href="/en/2018/01/06/2017-most-recommended/">2017 Best Recommendations - A Reward for Hard-Working Self</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/06</span>
            <a class="archive-post-title" href="/en/2018/01/06/Most-Recommended-of-2017/">2017 Annual Best Recommendations - Reward Yourself for Hard Work</a>
        </li>
                </ul>
            <div class="archive-year"> 2017 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">04/23</span>
            <a class="archive-post-title" href="/en/2017/04/23/About-work/">Reflections on Work and Growth (2017)</a>
        </li>
                </ul>
            <div class="archive-year"> 2016 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">04/05</span>
            <a class="archive-post-title" href="/en/2016/04/05/android-bottom-bar-2/">Android Bottom Navigation Spec Part 2: Style, Behavior, and Dimensions</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/05</span>
            <a class="archive-post-title" href="/en/2016/04/05/android-bottom-bar-1/">Android Bottom Navigation Spec Part 1: Usage</a>
        </li>
                </ul>
            <div class="archive-year"> 2015 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">12/31</span>
            <a class="archive-post-title" href="/en/2015/12/31/How-to-calculation-android-app-lunch-time/">How to Calculate App Startup Time in Android?</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">12/29</span>
            <a class="archive-post-title" href="/en/2015/12/29/Android-App-Launch-Optimization-DelayLoad-Part-2/">Android App Launch Optimization: Implementation and Principles of DelayLoad (Part 2)</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">11/18</span>
            <a class="archive-post-title" href="/en/2015/11/18/Android-app-lunch-optimize-delay-load/">Android App Startup Optimization - DelayLoad Implementation and Principles (Part 1)</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/12</span>
            <a class="archive-post-title" href="/en/2015/08/12/AndroidL-hwui-RenderThread-workflow/">RenderThread Workflow in Android hwui</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">08/05</span>
            <a class="archive-post-title" href="/en/2015/08/05/HashMap/">Java 7 HashMap Source Code Analysis</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/20</span>
            <a class="archive-post-title" href="/en/2015/07/20/Android-Performance-Memory-onTrimMemory/">Android Code Memory Optimization Suggestions - OnTrimMemory</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/20</span>
            <a class="archive-post-title" href="/en/2015/07/20/Android-Performance-Memory-AndroidResource/">Android Code Memory Optimization Suggestions - Android Resources</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/20</span>
            <a class="archive-post-title" href="/en/2015/07/20/Android-Performance-Memory-Java/">Android Code Memory Optimization Suggestions - Java (Official)</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">07/20</span>
            <a class="archive-post-title" href="/en/2015/07/20/Android-Performance-Memory-Google/">Android Code Memory Optimization Suggestions - Android (Official)</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/29</span>
            <a class="archive-post-title" href="/en/2015/05/29/Nexus6-with-Android-M/">Enabling Multi-Window Mode on Nexus 6 with Android M</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/06</span>
            <a class="archive-post-title" href="/en/2015/05/06/Java-Singleton/">A Detailed Guide to Java Singleton Pattern</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/19</span>
            <a class="archive-post-title" href="/en/2015/04/19/Android-Performance-Patterns-3/">Android Performance Patterns: Understanding VSYNC</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/19</span>
            <a class="archive-post-title" href="/en/2015/04/19/Android-Performance-Patterns-1/">Android Performance Patterns: Render Performance</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/19</span>
            <a class="archive-post-title" href="/en/2015/04/19/Android-Performance-Patterns-2/">Android Performance Patterns: Understanding Overdraw</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/19</span>
            <a class="archive-post-title" href="/en/2015/04/19/Android-Performance-Patterns-4/">Android Performance Patterns: Profile GPU Rendering</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/19</span>
            <a class="archive-post-title" href="/en/2015/04/19/Android-Performance-Patterns/">Overview of Android Performance Patterns</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/11</span>
            <a class="archive-post-title" href="/en/2015/04/11/AndroidMemory-Open-Bitmap-Object-In-MAT/">Android Memory Optimization (3) - Viewing Original Bitmaps in MAT</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/11</span>
            <a class="archive-post-title" href="/en/2015/04/11/AndroidMemory-Usage-Of-MAT/">Android Memory Optimization (1) - Getting Started with MAT</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">04/11</span>
            <a class="archive-post-title" href="/en/2015/04/11/AndroidMemory-Usage-Of-MAT-Pro/">Android Memory Optimization (2) - Advanced MAT Usage</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">03/31</span>
            <a class="archive-post-title" href="/en/2015/03/31/android-performance-case-study-follow-up/">Android Performance Case Study Follow-up</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">03/15</span>
            <a class="archive-post-title" href="/en/2015/03/15/android-tips-round-up-3/">Android Tips Round-Up, Part 3</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">03/15</span>
            <a class="archive-post-title" href="/en/2015/03/15/android-tips-round-up-4/">Android Tips Round-Up, Part 4</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">03/15</span>
            <a class="archive-post-title" href="/en/2015/03/15/android-tips-round-up-5/">Android Tips Round-Up, Part 5</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">02/04</span>
            <a class="archive-post-title" href="/en/2015/02/04/build-rom-for-nexus5/">Compiling Android Lollipop Firmware for Nexus 5</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/30</span>
            <a class="archive-post-title" href="/en/2015/01/30/android-performance-tools-systrace-1/">Android Performance Optimization - Introduction to Systrace (Part 1)</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/16</span>
            <a class="archive-post-title" href="/en/2015/01/16/view-android-source-code-with-androidstudio/">Viewing Android Lollipop Source Code with Android Studio</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">01/13</span>
            <a class="archive-post-title" href="/en/2015/01/13/android-performance-optimization-overdraw-2/">Android Performance Optimization: Overdraw - Practical Application</a>
        </li>
                </ul>
            <div class="archive-year"> 2014 </div>
            <ul class="year-list">
        <li class="archive-post-item">
            <span class="archive-post-date">10/20</span>
            <a class="archive-post-title" href="/en/2014/10/20/android-performance-optimization-overdraw-1/">Android Performance Optimization: Overdraw - Theory</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">06/03</span>
            <a class="archive-post-title" href="/en/2014/06/03/android-edittext-do-not-auto-get-focus/">Android Tips: How to Prevent EditText from Automatically Getting Focus</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/31</span>
            <a class="archive-post-title" href="/en/2014/05/31/android-tips-round-up-2/">Android Tips Round-Up, Part 2</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/28</span>
            <a class="archive-post-title" href="/en/2014/05/28/android-tips-round-up-1/">Android Tips Round-Up, Part 1</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">05/02</span>
            <a class="archive-post-title" href="/en/2014/05/02/android_log_to_file/">Android Tools - Log2File</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">03/25</span>
            <a class="archive-post-title" href="/en/2014/03/25/ubuntu-adb-can-not-find-devices/">Ubuntu: Adb Command Cannot Find Device</a>
        </li>
        <li class="archive-post-item">
            <span class="archive-post-date">03/17</span>
            <a class="archive-post-title" href="/en/2014/03/17/android-build-your-own-android-notification-service-app/">Android Service: Building Your Own Notification Center (1) - Introduction to Accessibility Service</a>
        </li>
            </ul>
    </div>
</div>

        <div class="sidebar-panel-tags">
    <div class="sidebar-tags-name">
            <span class="sidebar-tag-name" data-tags="Yearly Recommendations">
                <span class="iconfont-archer">&#xe606;</span>
                Yearly Recommendations
            </span>
            <span class="sidebar-tag-name" data-tags="Startup">
                <span class="iconfont-archer">&#xe606;</span>
                Startup
            </span>
            <span class="sidebar-tag-name" data-tags="Memory">
                <span class="iconfont-archer">&#xe606;</span>
                Memory
            </span>
            <span class="sidebar-tag-name" data-tags="Android">
                <span class="iconfont-archer">&#xe606;</span>
                Android
            </span>
            <span class="sidebar-tag-name" data-tags="Jank">
                <span class="iconfont-archer">&#xe606;</span>
                Jank
            </span>
            <span class="sidebar-tag-name" data-tags="Perfetto">
                <span class="iconfont-archer">&#xe606;</span>
                Perfetto
            </span>
            <span class="sidebar-tag-name" data-tags="Systrace">
                <span class="iconfont-archer">&#xe606;</span>
                Systrace
            </span>
            <span class="sidebar-tag-name" data-tags="Year in Review">
                <span class="iconfont-archer">&#xe606;</span>
                Year in Review
            </span>
            <span class="sidebar-tag-name" data-tags="Knowledge Planet">
                <span class="iconfont-archer">&#xe606;</span>
                Knowledge Planet
            </span>
            <span class="sidebar-tag-name" data-tags="Essays">
                <span class="iconfont-archer">&#xe606;</span>
                Essays
            </span>
            <span class="sidebar-tag-name" data-tags="ANR">
                <span class="iconfont-archer">&#xe606;</span>
                ANR
            </span>
            <span class="sidebar-tag-name" data-tags="Performance">
                <span class="iconfont-archer">&#xe606;</span>
                Performance
            </span>
            <span class="sidebar-tag-name" data-tags="Tools">
                <span class="iconfont-archer">&#xe606;</span>
                Tools
            </span>
            <span class="sidebar-tag-name" data-tags="RenderThread">
                <span class="iconfont-archer">&#xe606;</span>
                RenderThread
            </span>
            <span class="sidebar-tag-name" data-tags="DelayLoad">
                <span class="iconfont-archer">&#xe606;</span>
                DelayLoad
            </span>
            <span class="sidebar-tag-name" data-tags="Java">
                <span class="iconfont-archer">&#xe606;</span>
                Java
            </span>
            <span class="sidebar-tag-name" data-tags="Linux">
                <span class="iconfont-archer">&#xe606;</span>
                Linux
            </span>
            <span class="sidebar-tag-name" data-tags="Framework">
                <span class="iconfont-archer">&#xe606;</span>
                Framework
            </span>
            <span class="sidebar-tag-name" data-tags="Performance Optimization">
                <span class="iconfont-archer">&#xe606;</span>
                Performance Optimization
            </span>
            <span class="sidebar-tag-name" data-tags="Thread Optimization">
                <span class="iconfont-archer">&#xe606;</span>
                Thread Optimization
            </span>
            <span class="sidebar-tag-name" data-tags="Jank Optimization">
                <span class="iconfont-archer">&#xe606;</span>
                Jank Optimization
            </span>
            <span class="sidebar-tag-name" data-tags="Battery Optimization">
                <span class="iconfont-archer">&#xe606;</span>
                Battery Optimization
            </span>
            <span class="sidebar-tag-name" data-tags="ANR Analysis">
                <span class="iconfont-archer">&#xe606;</span>
                ANR Analysis
            </span>
            <span class="sidebar-tag-name" data-tags="Page Response">
                <span class="iconfont-archer">&#xe606;</span>
                Page Response
            </span>
            <span class="sidebar-tag-name" data-tags="Binder">
                <span class="iconfont-archer">&#xe606;</span>
                Binder
            </span>
            <span class="sidebar-tag-name" data-tags="Locking">
                <span class="iconfont-archer">&#xe606;</span>
                Locking
            </span>
            <span class="sidebar-tag-name" data-tags="Scheduling">
                <span class="iconfont-archer">&#xe606;</span>
                Scheduling
            </span>
            <span class="sidebar-tag-name" data-tags="MAT">
                <span class="iconfont-archer">&#xe606;</span>
                MAT
            </span>
            <span class="sidebar-tag-name" data-tags="Compose">
                <span class="iconfont-archer">&#xe606;</span>
                Compose
            </span>
            <span class="sidebar-tag-name" data-tags="Kotlin">
                <span class="iconfont-archer">&#xe606;</span>
                Kotlin
            </span>
            <span class="sidebar-tag-name" data-tags="HashMap">
                <span class="iconfont-archer">&#xe606;</span>
                HashMap
            </span>
            <span class="sidebar-tag-name" data-tags="Programmer">
                <span class="iconfont-archer">&#xe606;</span>
                Programmer
            </span>
            <span class="sidebar-tag-name" data-tags="Annual Recommendations">
                <span class="iconfont-archer">&#xe606;</span>
                Annual Recommendations
            </span>
            <span class="sidebar-tag-name" data-tags="Sharp Tools">
                <span class="iconfont-archer">&#xe606;</span>
                Sharp Tools
            </span>
            <span class="sidebar-tag-name" data-tags="Productivity">
                <span class="iconfont-archer">&#xe606;</span>
                Productivity
            </span>
            <span class="sidebar-tag-name" data-tags="Singleton">
                <span class="iconfont-archer">&#xe606;</span>
                Singleton
            </span>
            <span class="sidebar-tag-name" data-tags="Nexus">
                <span class="iconfont-archer">&#xe606;</span>
                Nexus
            </span>
            <span class="sidebar-tag-name" data-tags="Design Specs">
                <span class="iconfont-archer">&#xe606;</span>
                Design Specs
            </span>
            <span class="sidebar-tag-name" data-tags="Process">
                <span class="iconfont-archer">&#xe606;</span>
                Process
            </span>
            <span class="sidebar-tag-name" data-tags="Stutter">
                <span class="iconfont-archer">&#xe606;</span>
                Stutter
            </span>
            <span class="sidebar-tag-name" data-tags="Overdraw">
                <span class="iconfont-archer">&#xe606;</span>
                Overdraw
            </span>
            <span class="sidebar-tag-name" data-tags="Reading Notes">
                <span class="iconfont-archer">&#xe606;</span>
                Reading Notes
            </span>
            <span class="sidebar-tag-name" data-tags="The Programmer's Apprenticeship">
                <span class="iconfont-archer">&#xe606;</span>
                The Programmer's Apprenticeship
            </span>
            <span class="sidebar-tag-name" data-tags="Design Principles">
                <span class="iconfont-archer">&#xe606;</span>
                Design Principles
            </span>
            <span class="sidebar-tag-name" data-tags="Testing">
                <span class="iconfont-archer">&#xe606;</span>
                Testing
            </span>
            <span class="sidebar-tag-name" data-tags="Internet">
                <span class="iconfont-archer">&#xe606;</span>
                Internet
            </span>
            <span class="sidebar-tag-name" data-tags="Game Programming">
                <span class="iconfont-archer">&#xe606;</span>
                Game Programming
            </span>
            <span class="sidebar-tag-name" data-tags="User Experience">
                <span class="iconfont-archer">&#xe606;</span>
                User Experience
            </span>
            <span class="sidebar-tag-name" data-tags="Liqi">
                <span class="iconfont-archer">&#xe606;</span>
                Liqi
            </span>
            <span class="sidebar-tag-name" data-tags="Community">
                <span class="iconfont-archer">&#xe606;</span>
                Community
            </span>
            <span class="sidebar-tag-name" data-tags="Smooth">
                <span class="iconfont-archer">&#xe606;</span>
                Smooth
            </span>
            <span class="sidebar-tag-name" data-tags="Experience Optimization">
                <span class="iconfont-archer">&#xe606;</span>
                Experience Optimization
            </span>
            <span class="sidebar-tag-name" data-tags="Reading">
                <span class="iconfont-archer">&#xe606;</span>
                Reading
            </span>
    </div>
    <div class="iconfont-archer sidebar-tags-empty">&#xe678;</div>
    <div class="tag-load-fail" style="display: none; color: #ccc; font-size: 0.6rem;">
        缺失模块，请参考主题文档进行安装配置：https://github.com/fi3ework/hexo-theme-archer#%E5%AE%89%E8%A3%85%E4%B8%BB%E9%A2%98
    </div> 
    <div class="sidebar-tags-list"></div>
</div>

        <div class="sidebar-panel-categories">
    <div class="sidebar-categories-name">
        <span class="sidebar-category-name" data-categories="Casual Notes">
            <span class="iconfont-archer">&#xe60a;</span>
            Casual Notes
        </span>
        <span class="sidebar-category-name" data-categories="Reading Notes">
            <span class="iconfont-archer">&#xe60a;</span>
            Reading Notes
        </span>
        <span class="sidebar-category-name" data-categories="Essays">
            <span class="iconfont-archer">&#xe60a;</span>
            Essays
        </span>
        <span class="sidebar-category-name" data-categories="Android">
            <span class="iconfont-archer">&#xe60a;</span>
            Android
        </span>
        <span class="sidebar-category-name" data-categories="Java">
            <span class="iconfont-archer">&#xe60a;</span>
            Java
        </span>
        <span class="sidebar-category-name" data-categories="Android Performance Optimization">
            <span class="iconfont-archer">&#xe60a;</span>
            Android Performance Optimization
        </span>
    </div>
    <div class="iconfont-archer sidebar-categories-empty">&#xe678;</div>
    <div class="sidebar-categories-list"></div>
</div>

    </div>
</div>

        <!-- site-meta -->
        <script>
    var siteMetaRoot = "/en/"
    if (siteMetaRoot === "undefined") {
        siteMetaRoot = '/'
    }
    var siteMeta = {
        url: "https://androidperformance.com/en",
        root: siteMetaRoot,
        author: "Gracker"
    }
</script>

        <!-- import experimental options here -->
        <!-- Custom Font -->

        <!-- jquery (must load before main.js) -->
        <script defer src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <!-- main func (depends on jQuery) -->
        <script src="/en/scripts/main.js" defer></script>
        <!-- fancybox -->
        <script>
            (function(){
              var urls = [
                'https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.36/fancybox/fancybox.umd.js',
                'https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.36/dist/fancybox/fancybox.umd.js'
              ];
              function loadNext(){
                var u = urls.shift();
                if(!u) return;
                var s = document.createElement('script');
                s.src = u; s.defer = true;
                s.onload = function(){ if (window.Fancybox) { window.Fancybox.bind('[data-fancybox]'); } };
                s.onerror = loadNext;
                document.head.appendChild(s);
              }
              loadNext();
            })();
        </script>
        <!-- algolia -->
        <!-- busuanzi (delay load + silent fail) -->
        <!-- async load share.js on first click -->
            <script>
                (function(){
                  var loaded = false
                  function loadShare(){
                    if (loaded) return
                    loaded = true
                    var s = document.createElement('script')
                    s.src = '/en/scripts/share.js'
                    s.async = true
                    document.head.appendChild(s)
                  }
                  document.addEventListener('click', function(e){
                    var t = e.target
                    if (!t) return
                    if (t.closest && t.closest('.share-wrapper')) { loadShare() }
                    else if (t.classList && t.classList.contains('share-wrapper')) { loadShare() }
                  }, true)
                })();
            </script>
        <!-- mermaid -->
    </body>
</html>
